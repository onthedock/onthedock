<!DOCTYPE html>
<html ⚡>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="theme-color" content="#263238">

<meta name="generator" content="Hugo 0.79.0" />

<link rel="apple-touch-icon" href="https://onthedock.github.io/images/logo.png">


<link rel="canonical" href="https://onthedock.github.io/post/200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn/">


    
    <link href="https://fonts.googleapis.com/css?family=Lobster|Lato:400,700" rel="stylesheet">
    
    <title>Prueba de Concepto de notificaciones via CloudWatch Events desde CloudFormation (sin Lambdas) - On The Dock</title>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    
    <script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script>
<script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
<script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script>

    
<meta name="description" content="&lt;p&gt;En la entrada &lt;a href=&#34;https://onthedock.github.io/post/200507-envio-de-eventos-de-cfn-a-cwevents/&#34;&gt;Envío de eventos de CloudFormation a CloudWatch Events&lt;/a&gt; explicaba una manera alternativa -sin Lambdas- para enviar notificaciones SNS con información de ARNs de recursos generados en CloudFormation a través de CloudWatch Events.&lt;/p&gt;&lt;p&gt;En esta entrada explico cómo he realizado una prueba de concepto para validar que es viable.&lt;/p&gt;">

<meta property="og:title" content="Prueba de Concepto de notificaciones via CloudWatch Events desde CloudFormation (sin Lambdas) - On The Dock">
<meta property="og:type" content="article">
<meta property="og:url" content="https://onthedock.github.io/post/200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn/">
<meta property="og:image" content="https://onthedock.github.io/images/aws.png">
<meta property="og:site_name" content="On The Dock">
<meta property="og:description" content="&lt;p&gt;En la entrada &lt;a href=&#34;https://onthedock.github.io/post/200507-envio-de-eventos-de-cfn-a-cwevents/&#34;&gt;Envío de eventos de CloudFormation a CloudWatch Events&lt;/a&gt; explicaba una manera alternativa -sin Lambdas- para enviar notificaciones SNS con información de ARNs de recursos generados en CloudFormation a través de CloudWatch Events.&lt;/p&gt;&lt;p&gt;En esta entrada explico cómo he realizado una prueba de concepto para validar que es viable.&lt;/p&gt;">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="On The Dock">
<meta name="twitter:url" content="https://onthedock.github.io/post/200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn/">
<meta name="twitter:title" content="Prueba de Concepto de notificaciones via CloudWatch Events desde CloudFormation (sin Lambdas) - On The Dock">
<meta name="twitter:description" content="&lt;p&gt;En la entrada &lt;a href=&#34;https://onthedock.github.io/post/200507-envio-de-eventos-de-cfn-a-cwevents/&#34;&gt;Envío de eventos de CloudFormation a CloudWatch Events&lt;/a&gt; explicaba una manera alternativa -sin Lambdas- para enviar notificaciones SNS con información de ARNs de recursos generados en CloudFormation a través de CloudWatch Events.&lt;/p&gt;&lt;p&gt;En esta entrada explico cómo he realizado una prueba de concepto para validar que es viable.&lt;/p&gt;">
<meta name="twitter:image" content="https://onthedock.github.io/images/aws.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"https:\/\/onthedock.github.io\/"
    },
    "headline": "Prueba de Concepto de notificaciones via CloudWatch Events desde CloudFormation (sin Lambdas) - On The Dock",
    "image": {
      "@type": "ImageObject",
      "url": "https:\/\/onthedock.github.io\/images\/aws.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2020-05-10T00:42:51JST",
    "dateModified": "2020-05-10T00:42:51JST",
    "author": {
      "@type": "Person",
      "name": "On The Dock"
    },
    "publisher": {
      "@type": "Organization",
      "name": "On The Dock",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/onthedock.github.io\/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "\u003cp\u003eEn la entrada \u003ca href=\u0022https:\/\/onthedock.github.io\/post\/200507-envio-de-eventos-de-cfn-a-cwevents\/\u0022\u003eEnvío de eventos de CloudFormation a CloudWatch Events\u003c\/a\u003e explicaba una manera alternativa -sin Lambdas- para enviar notificaciones SNS con información de ARNs de recursos generados en CloudFormation a través de CloudWatch Events.\u003c\/p\u003e\n\u003cp\u003eEn esta entrada explico cómo he realizado una prueba de concepto para validar que es viable.\u003c\/p\u003e"
  }
</script>


    <style amp-custom>
      html { font-size: 18px;}@media (max-width: 768px) { html { font-size: 15px; }}body { font-family: Lato,'Hiragino Kaku Gothic Pro',メイリオ,Meiryo,sans-serif; font-size: inherit; margin: 0; color: #263238;}html, body { margin: 0;}a { text-decoration: none; color: #e91e63;}p { margin: 0;}ul,ol { margin: 0; padding: 0;}h1, h2, h3, h4, h5, h6 { margin: 0; font-weight: 700;}h1 { font-size: 1.8rem; line-height: 2rem; margin: 1.5rem 0; }h2 { font-size: 1.4rem; line-height: 2rem; margin: 1.5rem 0; }h3 { font-size: 1.2rem; line-height: 1.5rem; margin: 1.5rem 0; }h4, h5, h6 { font-size: 1rem; line-height: 1.5rem; margin: 1.5rem 0; }.clearfix::after { content: ''; display: block; clear: both;}main{ display: block;}.searchbar{ display: block; border: none; margin: 1em auto; max-width: 780px; text-align: center;}/* Layouts */.l-header { padding: .5rem 0; margin-bottom: 2rem; border-bottom: 1px dashed #cfd8dc; text-align: center;}.l-footer { font-size: .8rem; padding: 1rem 0; border-top: 1px dashed #cfd8dc;}.l-footer .copyright-notice,.l-footer .attribution { text-align: center;}.l-container { max-width: 42rem; margin: 0 auto; padding: 0 1rem;}/* Parts:logo */.p-logo { font-family: Lobster, cursive;}.p-logo a { color: #000; font-size: 1.6rem; line-height: 2rem;}/* Parts:section */section { border-top: 2px solid #eceff1; padding: 1.5rem 0;}section>header { text-transform: uppercase; font-weight: 700; margin-bottom: 2rem; text-align: center;}section>header span { display: inline-block; background-color: #000; color: #fff; letter-spacing: 3px; font-size: .7rem; padding: .5rem .75rem;}/* Parts:facts */.p-facts { list-style: none; font-size: .8rem; margin-bottom: 1rem;}.p-facts:last-child { margin-bottom: 0;}.p-facts li { display: inline-block; margin-right: .5rem; text-transform: uppercase;}.p-facts li header { margin-bottom: .25rem; font-weight: 700;}.p-facts li header a { color: #000; text-decoration: underline;}.p-facts li li { display: inline-block; margin-right: .5rem;}.p-facts li li::after { content: ',';}.p-facts li li:last-child::after { content: '';}/* Parts:crumb */.p-crumb { list-style: none; margin-bottom: 1rem; font-size: .8rem; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.p-crumb:last-child { margin-bottom: 0;}.p-crumb li { display: inline;}.p-crumb li::after { content: '›'; margin: 0 .5rem;}.p-crumb li:last-child::after { content: '';}/* Parts:page-title */.p-page-title { margin-bottom: 2rem;}.p-page-title .title { margin-bottom: .5rem;}/* Parts:share */.p-share { margin-bottom: 1.5rem; text-align: center;}.p-share a { display: inline-block; text-align: center; padding: .5rem .5rem; margin-right: .25rem; font-size: .6rem; background-color: #eceff1; font-weight: 700;}.p-share a.ht { color: #00a4de; }.p-share a.fb { color: #3b5998; }.p-share a.tw { color: #1da1f2; }.p-share a.ln { color: #00c300; }.p-share a.ht::before { content: 'Hatena'; }.p-share a.fb::before { content: 'Facebook'; }.p-share a.tw::before { content: 'Twitter'; }.p-share a.ln::before { content: 'LINE'; }/* Parts:terms */.p-terms { padding-left: 2rem;}/* Parts:paginator */.p-paginator { text-align: center; margin-bottom: 3rem; padding-top: 2rem;}.p-paginator a { display: inline-block; border: 2px solid #eceff1; color: #263238; line-height: 2rem; padding: 0 1rem;}/* Parts:article */.p-articles { list-style: none;}.p-articles>li { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px dashed #cfd8dc;}.p-articles>li:last-child { border-bottom: none; padding-bottom: 0;}.p-articles.thin>li { margin-bottom: 1rem; padding-bottom: 1rem;}article .article-header { display: table-cell; height: 6rem; vertical-align: middle;}article .title { margin: 0; margin-bottom: .5rem; font-size: 1.4rem; line-height: 2rem;}article .title a { color: #000;}article .header-wrapper { margin-bottom: 1.5rem;}article .thumbnail { display: block; background-position: center; background-size: cover; background-image: url(https://onthedock.github.io/images/default.jpg); width: 6rem; height: 6rem; border-radius: 50%; box-shadow: 0 0 3px 0 #333 inset; float: left; margin-right: 1rem;}article .summary { margin-bottom: 1.5rem;}article .readmore { text-align: center;}article .readmore a { font-size: .8rem; color: #000; text-decoration: underline;}article.li.sm .header-wrapper { margin-bottom: 0;}.article-body h2 { padding: 1rem 0; color: #55bbbb; border-bottom: 2px solid #eceff1;}.article-body h2:first-child { margin-top: 0; }.article-body h3 { color: #8997e4; font-style: italic;}.article-body h4 { border-left: solid .25rem #cddc39; padding: 0 .5rem;}.article-body p { margin: 1.5rem 0; line-height: 1.5rem;}.article-body a { text-decoration: underline;}.article-body ul,.article-body ol { padding-left: 1.5rem;}.article-body li { line-height: 2rem;}.article-body code { display: inline-block; font-family: Menlo, consolas, monospace; background-color: #eceff1; font-size: .8rem; padding: 0 .5rem; line-height: 1.5rem;}.article-body pre { margin: 1.5rem 0; padding: 1.5rem; font-size: .8rem; background-color: #eeeeef; color: #444; overflow: auto;}.article-body pre code { background-color: transparent;}.article-body blockquote { /* margin: 1.2rem 0; padding: .5rem 0; */ /*font-size: .8rem;*/ border-top: 1px solid #eceff1; border-bottom: 1px solid #eceff1; color: #607d8b;}.article-body blockquote p { margin: .5rem 0; line-height: 1.5rem;}.article-body strong { /*box-shadow: 0 -.5rem 0 0 #f06292 inset;*/ font-style: bold; font-weight: 700; /*color: #ff5722; */}.article-body em { /*font-style: normal;*/ /*font-weight: 700; color: #00c300;*/ /*color: #00c300;*/ font-style: oblique;}.article-body figure { margin: 1.5rem -2rem; }.article-body figure.left,.article-body figure.right { width: 15rem; height: 12rem; margin-top: 0; margin-left: 0; margin-right: 0;}.article-body figure.left { float: left; margin-right: 1rem; margin-left: -2rem; }.article-body figure.right { float: right; margin-left: 1rem; margin-right: -2rem; }@media (max-width: 768px) { .article-body figure { margin: 1.5rem -1rem; } .article-body figure.left, .article-body figure.right { float: none; margin: 0 -1rem; width: auto; height: auto; }}.article-body figcaption { padding: .5rem 0; font-size: .8rem; text-align: center;}.article-body figcaption a { color: #263238;}

       .article-6196d298c4378d228f2ab7aeacc3b954 .thumbnail { background-image: url(https://onthedock.github.io/images/links.png);  }  .article-989c3a6a94e729ffbdf9bda5f321b198 .thumbnail { background-image: url(https://onthedock.github.io/images/roadmap.png);  }  .article-b5774c1af73ca2d2b4752dba3cca3af5 .thumbnail { background-image: url(https://onthedock.github.io/images/bug.png);  }  .article-5e7a622986ce86264ec760d50d1b24dc .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-5ebb631840a278963e57bd511343a7de .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-b81d424b8eb3bb8c288fe36d23387788 .thumbnail { background-image: url(https://onthedock.github.io/images/gitea.jpg);  }  .article-0626a0be459395ce9ead913f3f08adc4 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-fcee06d4be0563afd210fdcfb47dcff0 .thumbnail { background-image: url(https://onthedock.github.io/images/virtualbox.png);  }  .article-1db77bc78e9304df7ba062b03813a3be .thumbnail { background-image: url(https://onthedock.github.io/images/virtualbox.png);  }  .article-36c4d422ca047b8a471571c76b65d6c6 .thumbnail { background-image: url(https://onthedock.github.io/images/git.png);  }  .article-4c8c13dd5627da332e5774b27cf40099 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-6e92220fbd4bf73e9add44ea35db7875 .thumbnail { background-image: url(https://onthedock.github.io/images/cloud-init.png);  }  .article-65945fdc2f7a451d2eba88e27bcae615 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-d4ae75e268955792710fe6fdbf38a8cd .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-f875614400506b86e2eed3af9535c6f0 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-70ddbb73f4be0ef264658d45b44a1501 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-af7ce20f88530a679b64bc11f369dd66 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-749180de0a0f927ac4118d5f742aec7a .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-eabbba2a574b52017ab09aadb1e27892 .thumbnail { background-image: url(https://onthedock.github.io/images/git.png);  }  .article-4df08a53150d4f7d2766c8debd1831a3 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-ae823e9b9f3db0ab3a477ed5e16bcb32 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-9e165e5c05a4125a00ec1ec5048a7d4c .thumbnail { background-image: url(https://onthedock.github.io/images/git.png);  }  .article-0b46f42d26003d0a8a0c0a8792e872c3 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-bf486333bdc41366eb67ebcd83df7dfd .thumbnail { background-image: url(https://onthedock.github.io/images/okd.png);  }  .article-5b04a4598c80921d43637c7023ad4877 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-6548eb3cdf7ceb97a246efd3d61b22ae .thumbnail { background-image: url(https://onthedock.github.io/images/code.jpg);  }  .article-67ffd386f3fb60aa875a1b304dcbd33c .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-fdbe83149bbb772c83e8270b925cba5f .thumbnail { background-image: url(https://onthedock.github.io/images/code.jpg);  }  .article-fa396b4de84b2dfd9b95c5edfc10cc30 .thumbnail { background-image: url(https://onthedock.github.io/images/python.png);  }  .article-296c831bcc1b030d00b8ee27e96a5226 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-b2b753da998b1936d8c475787c1de07f .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-b95004b4126fa41395385c5e37f31081 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-a8fd68175b85c6ab1e57dd164e56c25e .thumbnail { background-image: url(https://onthedock.github.io/images/MabelAmber-mini.png);  }  .article-cd0ad924309bc0e2310a28f4574f3ee6 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-c4149a0be2e1a3d215d0b9dbb1340cad .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-c04747c53dc824266e9428efb65f072d .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-c6d431118f1f3fa0e4ec3e6e454bb634 .thumbnail { background-image: url(https://onthedock.github.io/images/roadmap.png);  }  .article-1ce4351c9635f2cadcc6057dd96238d9 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-8cb097c83a6ec6e1fe01c4278c8a35c6 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-22355649e0a434b67e571674216e1e54 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-23858711b322c88a48f2b2d742a36f3d .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-d92b1a0387e28368be9738f69f1aa7ce .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-98124356b113c2a6917683aca3c29a99 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-a093ac0f1b7268afeade39452595d2f1 .thumbnail { background-image: url(https://onthedock.github.io/images/bug.png);  }  .article-38834ecfa3e2f37d5a70e6884d71074a .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-932932e45567c9f06aca44ce87e2a385 .thumbnail { background-image: url(https://onthedock.github.io/images/bug.png);  }  .article-c1ca90597f186bd1ad8bb1c94f4a447a .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-765192a6c291e47974a12dcf8924d8db .thumbnail { background-image: url(https://onthedock.github.io/images/ansible.png);  }  .article-b764fa70c94a1d2fd4fd14237d21967d .thumbnail { background-image: url(https://onthedock.github.io/images/python.png);  }  .article-f68c36fc2fb55e32944f45e490e5e5e9 .thumbnail { background-image: url(https://onthedock.github.io/images/ansible.png);  }  .article-bd81d8ba70bc61639103fb97b7490aed .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-1c63237c8383a2e30ee2e3fcc7150643 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-c0152a70142649803b63b10edd4921d3 .thumbnail { background-image: url(https://onthedock.github.io/images/asciidoctor.png);  }  .article-396652c83bff211b566a6a3fd5bf1913 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-bde56cbd0283e6a7909a444b8e08e5c5 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-0c530d26aef03bb376ea14c3014c0325 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-0d445519a7825dfd55db94b8b9817031 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-a57735573e4d2b1c48a69a09a73878b7 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-ccf02aadbf150df00f9a2962c5cc2c32 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-b4fa6645c244835f679427bd29ec86fb .thumbnail { background-image: url(https://onthedock.github.io/images/190101/amazonlinux.png);  }  .article-1f90092555e2ba74f132561ef66df1d5 .thumbnail { background-image: url(https://onthedock.github.io/images/ansible.png);  }  .article-702ecd15d93c0a640329570a1515ec22 .thumbnail { background-image: url(https://onthedock.github.io/images/181124/roadmap.png);  }  .article-fe261e0b7d326a141c1ff662c1caf421 .thumbnail { background-image: url(https://onthedock.github.io/images/cloud-init.png);  }  .article-2fc7b42f0ad38b1d0c3bda16184154ed .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-9a5a658f072f34635bd665eae7d0d498 .thumbnail { background-image: url(https://onthedock.github.io/images/docker-compose.jpg);  }  .article-f8770956a383aeb68930a558bae85310 .thumbnail { background-image: url(https://onthedock.github.io/images/automation.png);  }  .article-d27d7b7a4057230acbe88420832d3a67 .thumbnail { background-image: url(https://onthedock.github.io/images/gitea.jpg);  }  .article-365473b8c27877be27245e38a5feb95c .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-8da35239d2403351cd1910b3939787f6 .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-4f389af4c69dce1f727b95af66218cc0 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-b63b63041915fd06eb96d2d6b298ac9b .thumbnail { background-image: url(https://onthedock.github.io/images/sonarqube.png);  }  .article-db94723578a25efdcd1489b628ae77c9 .thumbnail { background-image: url(https://onthedock.github.io/images/sonarqube.png);  }  .article-92e6838a86f3c412b36d6abbbb0f3f77 .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-8fd0d0535b25566772d8bfcab456999e .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-9d852d24f77755909ea56d2ce72cb408 .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-015f92caa0da0be71b6008713be0e15f .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-b40404c5768e20c9cf4a0ef9b40d5d8c .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-56679bf127fa712be78799b59e8ebcbe .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-c926846ccb5ddda2e607d41a7eed1e7e .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-439d0c4b480f76cd3e4e59c497020808 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-ca9a82a3e9074b202ea71b79b8f06d72 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-5dd2fbecd3c1861b16d6ccbae8458692 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-d27ecb2023ff85d0423abc98d4d8ded4 .thumbnail { background-image: url(https://onthedock.github.io/images/portainer.png);  }  .article-82fdfab1e200b6fc1a28801ee717993c .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-ff3cf8144aa52ea6d7195126da8ce676 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-88a2b37925efc71e7f9ec017570e19f0 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-f22b7fd29e14db2fbd6cd579c2a0d5c9 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-fc9c9a2b1dcd0c5683f7adbafda8f7c8 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-a45fe2c1cdbadc45cbf34a63ab37ebcc .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-9e27e7f162c2feae804cbc006c1c9349 .thumbnail { background-image: url(https://onthedock.github.io/images/MabelAmber-mini.png);  }  .article-2a7b6b0759e163accb88c9261e4c0bbf .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-340e5d68f76888b0b8debb38ef25d46b .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-2fc73bdfb18aaf2eb89944fb4f7d53de .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-70a1a0028c7c78526f004c0e3218a2b3 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-f81b2bb759a18deaa3b5575087686fe7 .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-156dcec052e59d7d9f0de2250fda46f4 .thumbnail { background-image: url(https://onthedock.github.io/images/dokuwiki-on-docker.png);  }  .article-f831baebaad56b8e3d70750749393da3 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-df14f92fc6edab1c8632e66ef7c7e5a6 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-516ab75e14eb7886aaab03ff75dbfc6b .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-d1ead2ec3d26cb7f91ef8234915eb13f .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-0b9c6f0820f2306f6cc2bfd170dccb8e .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-1cbc9cfd0ad3798b23d19eac020b3153 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-a32274b07ce43fef61c7f19e4b68f650 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-9b0b3a180af20b5c091134d23cb6d383 .thumbnail { background-image: url(https://onthedock.github.io/images/minio.jpg);  }  .article-b20735633157cb1e57eb0c1d05406149 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-d1e335a06f765bffda53d2e123044b27 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-c36c64b9d6ce0d2c95381976831c3160 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-ee7d8acecc9de179b9d1cecb3d253215 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-2480be47fe45cfc13b07c86c32ed8cda .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-99a6578fdc273f40a61d182bcb5917c4 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-3ffff09a2dd1f953bbb8624d88756829 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-0a9cef5c4637bd946188e37439fef69c .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-42a206d287914317761f7749b964ddb2 .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-85dee6c250520e561ebc93740f1d514f .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-a65000ba68f97000bb927be3f88f75bd .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-2de6ff3b0144ea18b2ef056107448a33 .thumbnail { background-image: url(https://onthedock.github.io/images/yaml.png);  }  .article-a8aea2191f0d8d238ab6217feba51ac3 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-67cd76b76e108b6604b344e92a3c329a .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-d341a5f8cd54b9da7a3a6d1168365c25 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-59e1fe22eaedce05afe517780f87cc98 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-87ee3835fe3b255e8566c3bfed2bd38b .thumbnail { background-image: url(https://onthedock.github.io/images/portainer.png);  }  .article-086bb6242700303c8a958c5e74df0ca9 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-4c6b9124141ca1a8135b9177248b7e15 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-911698c11286b3ef9eb1a11440c09845 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-6a0861472d6f0696079c81e3710d5fe8 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-40b8655184d8e4a2ca3650aece49e845 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-857a5f627557e7d92f1386f7c6e04dee .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-4db85da082f771e8fb9029adad4173ec .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-b69159ccecf58bff548bbd08481b6e15 .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-da222607e970c37b0b59d8011a2e3398 .thumbnail { background-image: url(https://onthedock.github.io/images/portainer.png);  }  .article-7b36708a64c36890ceb1bf481f3de1fa .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-d68e08dcca5eafff4ae0d8d06280bf02 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-8ff87e4d24c357bbee842dd088ef4cde .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-d0ca4b0abe6c0c6d22baa800e3fc9935 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-63c13529eb1936073e0adc09d7e35b59 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-2e821bde62a219fe0b94f62e989269e7 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-df564c824db9099fd85c925ad9635cda .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-203d2d443889d9d70ca2ad9abcca49aa .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-526bade0815ac377e81216604b97c5f7 .thumbnail { background-image: url(https://onthedock.github.io/images/github.png);  }  .article-3d9c586728a0009cb0621b0368120462 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-160ee3ec04bb73e590f125b42640b34b .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-c862ac2fb3511b386b4247a80aa6b90b .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-8a50a2d4216b1a3b2b46c646bd24c5e9 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-f027d2889032f918da8e3cc9c03169e0 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-6db4ecfe853552466ce5a71b1221a2a0 .thumbnail { background-image: url(https://onthedock.github.io/images/hypriot.png);  } 
    </style>
  </head>

  <body>
    
    
    

    <header class="l-header">
      <div class="l-container">
        <div class="h-logo p-logo">
          <a href="https://onthedock.github.io/" class="h-logo">On The Dock</a>
          <p class="h-logo">Un blog sobre el Cloud, Kubernetes, DevOps, Docker y Raspberry Pi por Xavier Aznar</p>
        </div>
      </div>
    </header>

    <main>
      
<div class="l-container">
  <article class="single article-ae823e9b9f3db0ab3a477ed5e16bcb32">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn/" class="thumbnail" title="Prueba de Concepto de notificaciones via CloudWatch Events desde CloudFormation (sin Lambdas)"></a>
    <header class="article-header">
      <div class="clearfix">
        <h1 class="title">Prueba de Concepto de notificaciones via CloudWatch Events desde CloudFormation (sin Lambdas)</h1>
        <ul class="p-facts">
          <li><time datetime="2020-05-10T00:42:51JST">10 May 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
          <li>Xavier Aznar</li>
        </ul>
      </div>
    </header>
  </div>

  <div class="article-body"><p>En la entrada <a href="https://onthedock.github.io/post/200507-envio-de-eventos-de-cfn-a-cwevents/">Envío de eventos de CloudFormation a CloudWatch Events</a> explicaba una manera alternativa -sin Lambdas- para enviar notificaciones SNS con información de ARNs de recursos generados en CloudFormation a través de CloudWatch Events.</p>
<p>En esta entrada explico cómo he realizado una prueba de concepto para validar que es viable.</p>
<p>El objetivo de la prueba es ver si el concepto de usar la actualización en Parameter Store desde una plantilla de CloudFormation realmente permite disparar una regla en CloudWatch Events que lance una notificación a un <em>topic</em> SNS (configurado para enviar un correo) a través de CloudWatch Events.</p>
<p>El primer paso es crear una plantilla de CloudFormation que cree un recurso en AWS. Guardaremos el valor generado para ese recurso (el ARN de una policy) como parámetro en Parameter Store (también mediante CloudFormation).</p>
<p>Previamente debemos configurar los <em>servicios de soporte</em>, que son:</p>
<ul>
<li><em>Topic</em> SNS de envío de notificaciones por correo (para recibir las notificaciones por correo, debemos validar la suscripción previamente)</li>
<li>regla en CloudWatch Events</li>
</ul>
<p>Empezamos por la plantilla de CloudFormation que genere una <em>política</em> gestionada.</p>
<h2 id="plantilla-para-crear-una-managed-policy">Plantilla para crear una <em>managed policy</em></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">AWSTemplateFormatVersion</span>: <span style="color:#e6db74">2010-09-09</span>
<span style="color:#f92672">Description</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">  </span>  <span style="color:#ae81ff">Sample CloudFormation template</span>
<span style="color:#f92672">Resources</span>:
  <span style="color:#f92672">S3GetObjSamplePolicy</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#e6db74">&#34;AWS::IAM::ManagedPolicy&#34;</span>
    <span style="color:#f92672">Properties</span>:
      <span style="color:#f92672">Description</span>: <span style="color:#ae81ff">Simple S3 GetObject policy</span>
      <span style="color:#f92672">Path</span>: <span style="color:#ae81ff">/LAB/</span>
      <span style="color:#f92672">PolicyDocument</span>:
        <span style="color:#f92672">Version</span>: <span style="color:#e6db74">2012-10-17</span>
        <span style="color:#f92672">Statement</span>:
        -
          <span style="color:#f92672">Action</span>: <span style="color:#e6db74">&#39;s3:GetObject&#39;</span>
          <span style="color:#f92672">Effect</span>: <span style="color:#e6db74">&#39;Allow&#39;</span>
          <span style="color:#f92672">Resource</span>: <span style="color:#e6db74">&#39;*&#39;</span>
  <span style="color:#f92672">S3GetObjSamplePolicyARN</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#e6db74">&#34;AWS::SSM::Parameter&#34;</span>
    <span style="color:#f92672">Properties</span>:
      <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">String</span>
      <span style="color:#f92672">Description</span>: <span style="color:#ae81ff">Simple S3 GetObject policy ARN</span>
      <span style="color:#f92672">Value</span>: !<span style="color:#ae81ff">Ref S3GetObjSamplePolicy</span>
</code></pre></div><p>Validamos que la plantilla funciona correctamente y crea dos recursos:</p>
<ul>
<li>política gestionada <code>S3GetObjSamplePolicy</code> con <em>Physical ID</em> <code>arn:aws:iam::123456789012:policy/LAB/lab-managedpolicy-S3GetObjSamplePolicy-${random}</code></li>
<li>parámetro en SSM <code>S3GetObjSamplePolicyARN</code> con <em>Physical ID</em> <code>CFN-S3GetObjSamplePolicyARN-${random}</code>. El valor del parámetro es el ARN de la política creada.</li>
</ul>
<p>Ahora configuramos los <em>servicios de soporte</em>. Empezamos creando el <em>el topic</em> que enviará las notificaciones por correo. Para ello, creamos el <em>topic</em> y la subscripción (por correo).</p>
<h2 id="creación-del-topic-sns">Creación del <em>topic</em> SNS</h2>
<p>Validamos que la siguiente plantilla crea el <em>topic</em> SNS con uns subscripción de envío vía correo:</p>
<blockquote>
<p>La dirección de correo <strong>no se registra</strong> en la traza almacenada en CloudTrail de la llamada a la API para realizar la creación de la suscripción.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">AWSTemplateFormatVersion</span>: <span style="color:#e6db74">2010-09-09</span>
<span style="color:#f92672">Parameters</span>:
  <span style="color:#f92672">TopicSubscriberEmail</span>:
    <span style="color:#f92672">Description</span>: <span style="color:#ae81ff">Email to send notifications to (requires confirming the subscription)</span>
    <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">String</span>
    <span style="color:#f92672">Default</span>: <span style="color:#ae81ff">xavi.aznar@example.lab  </span>
<span style="color:#f92672">Resources</span>:
  <span style="color:#f92672">TopicForNotifications</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">AWS::SNS::Topic</span>
    <span style="color:#f92672">Properties</span>:
      <span style="color:#f92672">Subscription</span>:
        - <span style="color:#f92672">Endpoint</span>: !<span style="color:#ae81ff">Ref TopicSubscriberEmail</span>
          <span style="color:#f92672">Protocol</span>: <span style="color:#ae81ff">email</span>
      <span style="color:#f92672">Tags</span>:
        -
          <span style="color:#f92672">Key</span>:    <span style="color:#e6db74">&#39;owner&#39;</span>
          <span style="color:#f92672">Value</span>:  <span style="color:#e6db74">&#39;xavi&#39;</span>
        -
          <span style="color:#f92672">Key</span>:    <span style="color:#e6db74">&#39;environment&#39;</span>
          <span style="color:#f92672">Value</span>:  <span style="color:#e6db74">&#39;lab&#39;</span>
</code></pre></div><p>La suscripción envía un correo al buzón indicado y la creación de la suscripción queda en estado <em>Pending Validation</em>. Cuando se acepta la subscripción -mediante el enlace enviado- el estado cambia a <em>Confirmed</em>.</p>
<blockquote>
<p>Podemos validar el correcto funcionamiento del <em>topic</em> y la suscripción desde la consola, pulsando sobre el botón <em>Publish message</em>.</p>
</blockquote>
<h2 id="creación-de-la-regla-en-cloudwatch-events">Creación de la regla en CloudWatch Events</h2>
<p>Añadimos una sección en la plantilla de CloudFormation de los <em>servicios de soporte</em> para crear la <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-events-rule.html">regla en CloudWatch Events</a>.</p>
<p>Para obtener el <code>EventPattern</code> de manera sencilla, puedes crearlo desde la consola web de AWS (y después convertirlo a YAML):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">source</span>:
- <span style="color:#ae81ff">aws.ssm</span>
<span style="color:#f92672">detail-type</span>:
- <span style="color:#ae81ff">AWS API Call via CloudTrail</span>
<span style="color:#f92672">detail</span>:
  <span style="color:#f92672">eventSource</span>:
  - <span style="color:#ae81ff">ssm.amazonaws.com</span>
  <span style="color:#f92672">eventName</span>:
  - <span style="color:#ae81ff">PutParameter</span>
</code></pre></div><blockquote>
<p>Una mejora -para la siguiente iteración- sería restringir el patrón para que sólo se <em>dispare</em> con los parámetros en un determinado <em>path</em>.  Primero creamos esta regla que <em>matchea</em> con la actualización de cualquier parámetro; cuando funcione, actualizamos la regla para <em>matchear</em> únicamente los parámetros en <code>/LAB/*</code>.</p>
</blockquote>
<p>La segunda parte de la regla consiste en definir el <em>target</em> de la acción a realizar cuando se valide la regla definida.</p>
<p>En nuestro caso, actuaremos sobre un <em>topic</em> SNS. La propiedad <code>Targets</code> de una regla en CloudWatch Events debe contener uno o más elementos de tipo <code>Target</code>.</p>
<p>Un <em>target</em> requiere el ARN del recurso y un <code>Id</code> (que es el nombre que asignamos al <em>target</em>); el resto de parámetros son opcionales.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">Type</span>: <span style="color:#ae81ff">AWS::Events::Rule</span>
<span style="color:#f92672">Properties</span>:
  <span style="color:#f92672">EventPattern</span>:
...
  <span style="color:#f92672">Targets</span>:
    -
      <span style="color:#f92672">Arn</span>: !<span style="color:#ae81ff">Ref TopicForNotifications</span>
      <span style="color:#f92672">Id</span>: !<span style="color:#ae81ff">Ref TopicForNotifications</span>
</code></pre></div><p>En la documentación se indica que debe facilitarse el ARN del rol que se asume cuando se ejecuta la regla. Este rol debe proporcionar permisos para que CloudWatch Events pueda enviar mensajes al <em>topic</em>.</p>
<p>Revisando el <em>topic</em> en la consola, vemos que tiene asociada una <em>access policy</em> que convierte en <em>público</em> para todos los <em>principals</em> de AWS en la cuenta (si lo interpreto correctamente (SPOILER: no es correcto)):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2008-10-17&#34;</span>,
  <span style="color:#f92672">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;__default_policy_ID&#34;</span>,
  <span style="color:#f92672">&#34;Statement&#34;</span>: [
    {
      <span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;__default_statement_ID&#34;</span>,
      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
      <span style="color:#f92672">&#34;Principal&#34;</span>: {
        <span style="color:#f92672">&#34;AWS&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
      },
      <span style="color:#f92672">&#34;Action&#34;</span>: [
        <span style="color:#e6db74">&#34;SNS:GetTopicAttributes&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:SetTopicAttributes&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:AddPermission&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:RemovePermission&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:DeleteTopic&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:Subscribe&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:ListSubscriptionsByTopic&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:Publish&#34;</span>,
        <span style="color:#e6db74">&#34;SNS:Receive&#34;</span>
      ],
      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:sns:${region}:123456789012:lab-topic-TopicForNotifications-${random}&#34;</span>,
      <span style="color:#f92672">&#34;Condition&#34;</span>: {
        <span style="color:#f92672">&#34;StringEquals&#34;</span>: {
          <span style="color:#f92672">&#34;AWS:SourceOwner&#34;</span>: <span style="color:#e6db74">&#34;123456789012&#34;</span>
        }
      }
    }
  ]
}
</code></pre></div><p>Una vez creados los <em>servicios de soporte</em>, lanzamos la plantilla original para crear los recursos (y el parámetro asociado), que debería disparar la regla de Events y enviarnos una notificación por correo vía SNS.</p>
<p>Aunque estoy realizando las acciones desde la consola con un rol de administrador, no recibo la notificación con el valor del ARN de la política creada.</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>En CloudWatch Events se observa que al crear el parámetro vía CloudFormation, se disparan las reglas; sin embargo, vemos que además de las métricas <em>TriggeredRules</em> e <em>Invocation</em> también aumenta la cuenta de <em>FailedInvocations</em> para el <em>topic</em>.</p>
<p>Revisando la página de <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CWE_Troubleshooting.html">Troubleshooting CloudWatch Events</a>, parece que la entrada que mejor se ajusta a mi situación es <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CWE_Troubleshooting.html#NoMessagesPublishedSNS">My rule is being triggered but I don&rsquo;t see any messages published into my Amazon SNS topic</a>.</p>
<p>Siguiendo las instrucciones indicadas, lanzo desde la CLI:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws sns get-topic-attributes --region $REGION --topic-arn $TOPICARN --profile local
</code></pre></div><p>La salida del comando -anonimizada- es:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;Attributes&#34;</span>: {
        <span style="color:#f92672">&#34;SubscriptionsConfirmed&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>,
        <span style="color:#f92672">&#34;DisplayName&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
        <span style="color:#f92672">&#34;SubscriptionsDeleted&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>,
        <span style="color:#f92672">&#34;EffectiveDeliveryPolicy&#34;</span>: <span style="color:#e6db74">&#34;{\&#34;http\&#34;:{\&#34;defaultHealthyRetryPolicy\&#34;:{\&#34;minDelayTarget\&#34;:20,\&#34;maxDelayTarget\&#34;:20,\&#34;numRetries\&#34;:3,\&#34;numMaxDelayRetries\&#34;:0,\&#34;numNoDelayRetries\&#34;:0,\&#34;numMinDelayRetries\&#34;:0,\&#34;backoffFunction\&#34;:\&#34;linear\&#34;},\&#34;disableSubscriptionOverrides\&#34;:false}}&#34;</span>,
        <span style="color:#f92672">&#34;Owner&#34;</span>: <span style="color:#e6db74">&#34;123456789012&#34;</span>,
        <span style="color:#f92672">&#34;Policy&#34;</span>: <span style="color:#e6db74">&#34;{\&#34;Version\&#34;:\&#34;2008-10-17\&#34;,\&#34;Id\&#34;:\&#34;__default_policy_ID\&#34;,\&#34;Statement\&#34;:[{\&#34;Sid\&#34;:\&#34;__default_statement_ID\&#34;,\&#34;Effect\&#34;:\&#34;Allow\&#34;,\&#34;Principal\&#34;:{\&#34;AWS\&#34;:\&#34;*\&#34;},\&#34;Action\&#34;:[\&#34;SNS:GetTopicAttributes\&#34;,\&#34;SNS:SetTopicAttributes\&#34;,\&#34;SNS:AddPermission\&#34;,\&#34;SNS:RemovePermission\&#34;,\&#34;SNS:DeleteTopic\&#34;,\&#34;SNS:Subscribe\&#34;,\&#34;SNS:ListSubscriptionsByTopic\&#34;,\&#34;SNS:Publish\&#34;,\&#34;SNS:Receive\&#34;],\&#34;Resource\&#34;:\&#34;arn:aws:sns:${region}:123456789012:lab-topic-TopicForNotifications-${random}\&#34;,\&#34;Condition\&#34;:{\&#34;StringEquals\&#34;:{\&#34;AWS:SourceOwner\&#34;:\&#34;123456789012\&#34;}}}]}&#34;</span>,
        <span style="color:#f92672">&#34;TopicArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:sns:${region}:123456789012:lab-topic-TopicForNotifications-${random}&#34;</span>,
        <span style="color:#f92672">&#34;SubscriptionsPending&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>
    }
}
</code></pre></div><p>Formateando mejor la salida se puede observar que en la respuesta sólo aparece la politica por defecto:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#960050;background-color:#1e0010">Policy</span><span style="color:#e6db74">&#34;: &#34;</span>{
  <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&#34;Version\&#34;:\&#34;2008-10-17\&#34;,
</span><span style="color:#f92672">  \&#34;Id\&#34;:\&#34;__default_policy_ID\&#34;,
</span><span style="color:#f92672">  \&#34;Statement\&#34;:[{
</span><span style="color:#f92672">    \&#34;Sid\&#34;:\&#34;__default_statement_ID\&#34;,
</span><span style="color:#f92672">    \&#34;Effect\&#34;:\&#34;Allow\&#34;,
</span><span style="color:#f92672">    \&#34;Principal\&#34;:{\&#34;AWS\&#34;:\&#34;*\&#34;},
</span><span style="color:#f92672">    \&#34;Action\&#34;:[
</span><span style="color:#f92672">        \&#34;SNS:GetTopicAttributes\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:SetTopicAttributes\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:AddPermission\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:RemovePermission\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:DeleteTopic\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:Subscribe\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:ListSubscriptionsByTopic\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:Publish\&#34;,
</span><span style="color:#f92672">        \&#34;SNS:Receive\&#34;
</span><span style="color:#f92672">    ],
</span><span style="color:#f92672">    \&#34;Resource\&#34;:\&#34;arn:aws:sns:${region}:123456789012:lab-topic-TopicForNotifications-${random}\&#34;,
</span><span style="color:#f92672">    \&#34;Condition\&#34;:{
</span><span style="color:#f92672">      \&#34;StringEquals\&#34;:{
</span><span style="color:#f92672">        \&#34;AWS:SourceOwner\&#34;:\&#34;123456789012\&#34;
</span><span style="color:#f92672">      }
</span><span style="color:#f92672">    }
</span><span style="color:#f92672">  }]
</span><span style="color:#f92672">}&#34;</span>,
</code></pre></div><p>La política por defecto no proporciona permisos de <code>Publish</code> a <code>events.amazonaws.com</code>, por lo que debemos establecerlo para que la regla de Events pueda publicar mensajes en el <em>topic</em> SNS.</p>
<p>Actualizamos la plantilla de CloudFormation para incluir la política y dar permisos a CloudWatch Events:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  <span style="color:#f92672">EventsRuleForSSMPutParameter</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#e6db74">&#34;AWS::Events::Rule&#34;</span>
...
  <span style="color:#f92672">EventTopicPolicy</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#e6db74">&#39;AWS::SNS::TopicPolicy&#39;</span>
    <span style="color:#f92672">Properties</span>:
      <span style="color:#f92672">PolicyDocument</span>:
        <span style="color:#f92672">Statement</span>:
          - <span style="color:#f92672">Effect</span>: <span style="color:#ae81ff">Allow</span>
            <span style="color:#f92672">Principal</span>:
              <span style="color:#f92672">Service</span>: <span style="color:#ae81ff">events.amazonaws.com</span>
            <span style="color:#f92672">Action</span>: <span style="color:#e6db74">&#39;sns:Publish&#39;</span>
            <span style="color:#f92672">Resource</span>: <span style="color:#e6db74">&#39;*&#39;</span>
      <span style="color:#f92672">Topics</span>:
        - !<span style="color:#ae81ff">Ref TopicForNotifications</span>
</code></pre></div><p>Repitiendo la comprobación indicada en la página de <em>troubleshooting</em> (he formateado la salida para que sea más fácil identificar la parte resaltada):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ aws sns get-topic-attributes --region $REGION --topic-arn $TOPICARN --profile local
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;Attributes&#34;</span>: <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;SubscriptionsConfirmed&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>,
        <span style="color:#e6db74">&#34;DisplayName&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
        <span style="color:#e6db74">&#34;SubscriptionsDeleted&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>,
        <span style="color:#e6db74">&#34;EffectiveDeliveryPolicy&#34;</span>: <span style="color:#e6db74">&#34;{\&#34;http\&#34;:{\&#34;defaultHealthyRetryPolicy\&#34;:{\&#34;minDelayTarget\&#34;:20,\&#34;maxDelayTarget\&#34;:20,\&#34;numRetries\&#34;:3,\&#34;numMaxDelayRetries\&#34;:0,\&#34;numNoDelayRetries\&#34;:0,\&#34;numMinDelayRetries\&#34;:0,\&#34;backoffFunction\&#34;:\&#34;linear\&#34;},\&#34;disableSubscriptionOverrides\&#34;:false}}&#34;</span>,
        <span style="color:#e6db74">&#34;Owner&#34;</span>: <span style="color:#e6db74">&#34;123456789012&#34;</span>,
        <span style="color:#e6db74">&#34;Policy&#34;</span>: <span style="color:#e6db74">&#34;{\&#34;Version\&#34;:\&#34;2008-10-17\&#34;,
</span><span style="color:#e6db74">          \&#34;Statement\&#34;:[{
</span><span style="color:#e6db74">            \&#34;Effect\&#34;:\&#34;Allow\&#34;,
</span><span style="color:#e6db74">            \&#34;Principal\&#34;:{
</span><span style="color:#e6db74">              \&#34;Service\&#34;:\&#34;events.amazonaws.com\&#34;
</span><span style="color:#e6db74">            },
</span><span style="color:#e6db74">            \&#34;Action\&#34;:\&#34;sns:Publish\&#34;,
</span><span style="color:#e6db74">            \&#34;Resource\&#34;:\&#34;*\&#34;}
</span><span style="color:#e6db74">          ]}&#34;</span>,
        <span style="color:#e6db74">&#34;TopicArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:sns:</span><span style="color:#e6db74">${</span>region<span style="color:#e6db74">}</span><span style="color:#e6db74">:123456789012:lab-topic-TopicForNotifications-</span><span style="color:#e6db74">${</span>random<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74">&#34;SubscriptionsPending&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Una vez actualizada la política, debería funcionar correctamente.</p>
<p>Borramos el <em>stack</em> anterior -correspondient a la creación del recurso y el parámetro y validamos que tras asignar los permisos, se dispara la regla y se envía la notificación vía  SNS.</p></div>

  <aside class="p-share">
  <a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fonthedock.github.io%2fpost%2f200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn%2f&text=Prueba%20de%20Concepto%20de%20notificaciones%20via%20CloudWatch%20Events%20desde%20CloudFormation%20%28sin%20Lambdas%29&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fonthedock.github.io%2fpost%2f200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn%2f&t=Prueba%20de%20Concepto%20de%20notificaciones%20via%20CloudWatch%20Events%20desde%20CloudFormation%20%28sin%20Lambdas%29" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://line.me/R/msg/text/?Prueba%20de%20Concepto%20de%20notificaciones%20via%20CloudWatch%20Events%20desde%20CloudFormation%20%28sin%20Lambdas%29 https%3a%2f%2fonthedock.github.io%2fpost%2f200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn%2f" title="LINEでシェア" class="ln" target="_blank" rel="nofollow"></a>
  <a href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fonthedock.github.io%2fpost%2f200510-prueba-de-concepto-de-notificaciones-via-sns-para-cfn%2f&title=Prueba%20de%20Concepto%20de%20notificaciones%20via%20CloudWatch%20Events%20desde%20CloudFormation%20%28sin%20Lambdas%29" title="はてなブックマーク" class="ht" target="_blank" rel="nofollow"></a>
  <div class="searchbar">
      <iframe src="https://duckduckgo.com/search.html?site=https://onthedock.github.io/&prefill=Busca en este sitio usando DuckDuckGo" style="width: 25em;height: 48px" frameborder="0"></iframe>
    </div>
</aside>


  <footer class="article-footer">
    <section>
      <ol class="p-crumb">
        <li><a href="https://onthedock.github.io/">On The Dock</a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://onthedock.github.io/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li>Prueba de Concepto de notificaciones via CloudWatch Events desde CloudFormation (sin Lambdas)</li>
      </ol>

      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="https://onthedock.github.io/categories/">categories</a></header>
          <ul>
            
            <li><a href="https://onthedock.github.io/categories/dev/">dev</a></li>
            
          </ul>
        </li>
      </ul>
      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="https://onthedock.github.io/tags/">tags</a></header>
          <ul>
            
            <li><a href="https://onthedock.github.io/tags/aws/">aws</a></li>
            
            <li><a href="https://onthedock.github.io/tags/cloudformation/">cloudformation</a></li>
            
            <li><a href="https://onthedock.github.io/tags/automation/">automation</a></li>
            
          </ul>
        </li>
      </ul>
      
      
    </section>
  </footer>
</article>

<article>
  <div id="disqus_thread"></div>
  <script>
  
  

  

  (function() { 
  var d = document, s = d.createElement('script');
  s.src = 'https://onthedock.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                              

</article>



  
  
  <section>
    <header><span>Latests</span></header>
    <ul class="p-articles thin">
      <li><article class="li sm article-6196d298c4378d228f2ab7aeacc3b954">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/201208-problemas-relacionados-con-gitops/" class="thumbnail" title="Interesante artículo &#34;More Problems with GitOps — and How to Fix Them&#34; en TheNewStack"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/201208-problemas-relacionados-con-gitops/">Interesante artículo &#34;More Problems with GitOps — and How to Fix Them&#34; en TheNewStack</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-12-08T07:54:26JST">8 Dec 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-989c3a6a94e729ffbdf9bda5f321b198">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/201206-side-project/" class="thumbnail" title="Side Project: devtoolbox"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/201206-side-project/">Side Project: devtoolbox</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-12-06T22:02:24JST">6 Dec 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-b5774c1af73ca2d2b4752dba3cca3af5">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/201013-instalar-mkdocs-en-alpine/" class="thumbnail" title="[Solucionado] Instalación de MkDocs en Alpine y en MacOS (Catalina)"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/201013-instalar-mkdocs-en-alpine/">[Solucionado] Instalación de MkDocs en Alpine y en MacOS (Catalina)</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-10-13T18:43:49JST">13 Oct 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-5e7a622986ce86264ec760d50d1b24dc">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/200926-imagenes-de-registries-diferentes-a-dockerhub/" class="thumbnail" title="Imagen base de un registry diferente a Docker Hub"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/200926-imagenes-de-registries-diferentes-a-dockerhub/">Imagen base de un registry diferente a Docker Hub</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-09-26T14:02:56JST">26 Sep 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li>
    </ul>
  </section>
  
</div>


    </main>

    

    <footer class="l-footer">
      <div class="l-container">
        <p class="copyright-notice">Handmade with &#9829; by Xavi Aznar</p>
        <aside>
          <p class="attribution">Powered by <a href="https://gohugo.io/">Hugo</a> using <a href="https://github.com/dim0627/hugo_theme_aglaus" class="h-logo">Aglaus</a> (designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>).</p>
        </aside>
      </div>
    </footer>

    <a href="#" class="p-movetop" title="ページ上部へ戻る" rel="nofollow"></a>
  </body>
</html>

