<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Windows on On The Dock</title>
    <link>https://onthedock.github.io/tags/windows/index.xml</link>
    <description>Recent content in Windows on On The Dock</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Handmade with &amp;#9829; by Xavi Aznar</copyright>
    <atom:link href="https://onthedock.github.io/tags/windows/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Vagrant: primeras impresiones</title>
      <link>https://onthedock.github.io/post/170521-vagrant-primeras-impresiones/</link>
      <pubDate>Sun, 21 May 2017 09:26:45 +0200</pubDate>
      
      <guid>https://onthedock.github.io/post/170521-vagrant-primeras-impresiones/</guid>
      <description>&lt;p&gt;He estado probando &lt;a href=&#34;https://www.vagrantup.com&#34;&gt;Vagrant&lt;/a&gt; para automatizar la creación de máquinas virtuales en las que probar Docker, etc.&lt;/p&gt;

&lt;p&gt;En este artículo comento mis primeras impresiones con Vagrant.&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;La &lt;em&gt;tagline&lt;/em&gt; de Vagrant es &lt;em&gt;Development Environments made easy&lt;/em&gt;. Atraido con la posibilidad de ser capaz de crear entornos de forma automática, instalé Vagrant. Tenía la sensación de que sería una especie de &lt;em&gt;Docker para máquinas virtuales&lt;/em&gt;: hay un repositorio público de &lt;em&gt;boxes&lt;/em&gt; llamado &lt;a href=&#34;https://atlas.hashicorp.com/boxes/search?&#34;&gt;Atlas&lt;/a&gt; y con unos comandos como &lt;code&gt;vagrant init&lt;/code&gt; y &lt;code&gt;vagrant up&lt;/code&gt; parece posible &lt;em&gt;levantar&lt;/em&gt; un conjunto de máquinas preconfiguradas y listas para trabajar.&lt;/p&gt;

&lt;p&gt;Pensaba que Vagrant trabajaba únicamente con VirtualBox, así que me alegré al ver que es posible trabajar con otros &lt;em&gt;providers&lt;/em&gt;, en particular al ver que soporta Hyper-V &lt;em&gt;out of the box&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Busqué una máquina con Ubuntu 16 LTS en Atlas filtrando por &lt;code&gt;provider hyperv&lt;/code&gt; y encontré &lt;a href=&#34;https://atlas.hashicorp.com/kmm/boxes/ubuntu-xenial64&#34;&gt;https://atlas.hashicorp.com/kmm/boxes/ubuntu-xenial64&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Mediante &lt;code&gt;vagrant init kmm/ubuntu-xenial64&lt;/code&gt; se crea el Vagrantfile, que describe las configuración de la VM.&lt;/p&gt;

&lt;p&gt;Para arrancar la máquina es necesario especificar el &lt;em&gt;provider&lt;/em&gt;, ya que por defecto se asume VirtualBox: &lt;code&gt;vagrant up --provider hyperv&lt;/code&gt;. El comando debe ejecutarse con permisos de administrador (debido a una limitación de Hyper-V).&lt;/p&gt;

&lt;p&gt;Al lanzar el comando por primera vez, como no tengo una copia local de la &lt;em&gt;box&lt;/em&gt;, debe descargarse. A diferencia de los contenedores, el tamaño de la máquina virtual es considerable. Afortunadamente la velocidad de la conexión y el hecho de que sólo tengo que hacerlo una vez mitigan este primer inconveniente.&lt;/p&gt;

&lt;p&gt;El comando inicializa la máquina y la registra en Hyper-V con el nombre &lt;code&gt;ubuntu-xenial64&lt;/code&gt;, arranca la máquina y obtiene una IP del DHCP. También se crea una clave SSH para poder conectar a la máquina y se monta una carpeta compartida entre la máquina virtual y el &lt;em&gt;host&lt;/em&gt; local (en la carpeta desde donde se lanza el comando &lt;code&gt;vagrant up&lt;/code&gt;). La máquina virtual también se crea en esa carpeta.&lt;/p&gt;

&lt;h2 id=&#34;conectando-vía-ssh&#34;&gt;Conectando vía SSH&lt;/h2&gt;

&lt;p&gt;En la documentación se indica que para conectar a la VM, hay que usar el comando &lt;code&gt;vagrant ssh&lt;/code&gt;. En Windows no funciona porque no hay un cliente SSH instalado por defecto.&lt;/p&gt;

&lt;p&gt;En Windows lo habitual es usar PuTTY, pero resulta que la clave privada que se ha generado no es compatible y es necesario convertirla al formato &lt;code&gt;ppk&lt;/code&gt;, usando &lt;a href=&#34;https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html&#34;&gt;PuTTYgen&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Al no tener una contraseña, esto significa que si quiero conectar desde otro equipo (por ejemplo, desde el Mac), tengo que copiar la clave privada al equipo.&lt;/p&gt;

&lt;h2 id=&#34;nombre-de-la-máquina-virtual&#34;&gt;Nombre de la máquina virtual&lt;/h2&gt;

&lt;p&gt;Aunque en la documentación se indica que puede especificarse el nombre de la máquina virtual mediante la opción &lt;a href=&#34;https://www.vagrantup.com/docs/hyperv/configuration.html#vmname&#34;&gt;&lt;code&gt;vmname&lt;/code&gt;&lt;/a&gt;, en mi caso no ha funcionado.&lt;/p&gt;

&lt;h2 id=&#34;ip-de-la-máquina-virtual&#34;&gt;IP de la máquina virtual&lt;/h2&gt;

&lt;p&gt;Aunque la máquina virtual arranca con la IP configurada en modo DHCP, me gustaría especificar la IP de la máquina a crear. Buscando en Google he encontrado que la IP debería poder configurarse mediante el parámetro: &lt;code&gt;config.vm.network :public_network, ip: &amp;quot;192.168.1.30&amp;quot;&lt;/code&gt;, tal y como se indica en &lt;a href=&#34;https://serverfault.com/questions/418422/public-static-ip-for-vagrant-box&#34;&gt;Public static ip for vagrant box&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;De nuevo, por algún motivo, no ha funcionado, obteniendo siempre la IP vía DHCP.&lt;/p&gt;

&lt;p&gt;No soy el único al que le pasa, por lo que parece: &lt;a href=&#34;https://github.com/cogitatio/vagrant-hostsupdater/issues/132&#34;&gt;static IP not set correctly&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;instalación-de-docker&#34;&gt;Instalación de Docker&lt;/h2&gt;

&lt;p&gt;Al final del fichero &lt;code&gt;Vagrantfile&lt;/code&gt; hay un apartado sobre &lt;em&gt;provisioning&lt;/em&gt;, para poder instalar paquetes adicionales en la máquina virtual. En mi caso, estaba interesado en instalar Docker, por ejemplo.&lt;/p&gt;

&lt;p&gt;Aunque en la documentación se indica que se pueden lanzar los comandos &lt;em&gt;tal cual&lt;/em&gt;, de nuevo no ha funcionado como esperaba:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;apt-get update
apt-get install docker.io -y
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tras el primer fallo he modificado el fichero &lt;code&gt;Vagrantfile&lt;/code&gt; para que los comandos se lancen como &lt;code&gt;root&lt;/code&gt; (&lt;code&gt;sudo apt-get update&lt;/code&gt;), pero no sólo no he solucionado el problema, sino que además al intentar lanzar manualmente, conectado a la máquina virtual la instalación, obtenía un error indicando que el fichero estaba en uso.&lt;/p&gt;

&lt;h2 id=&#34;montaje-de-la-carpeta-compartida&#34;&gt;Montaje de la carpeta compartida&lt;/h2&gt;

&lt;p&gt;Inicialmente he pensado que sería una buena idea poder disponer de una carpeta &lt;em&gt;de intercambio&lt;/em&gt;. Después de tener que lanzar múltiples máquinas virtuales para las pruebas de cambiar el nombre de la máquina virtual, la configuración de la IP, etc, me he dado cuenta que la carpeta compartida no sólo no me aporta nada, sino que ralentiza el proceso; se solicita usuario y password para montar la carpeta, de manera que el script se detiene (aunque la máquina arranca en Hyper-V). Incluso después de terminar el proceso mediante &lt;code&gt;Ctrl+C&lt;/code&gt; he tenido problemas para seguir ejecutando otros comandos (&lt;code&gt;vagrant destroy&lt;/code&gt;). En este caso, Ruby -el lenguaje usado por Vagrant- seguía en memoria y ha sido necesario matarlo a través del adminstrador de tareas para poder seguir ejecutando comandos Vagrant.&lt;/p&gt;

&lt;h2 id=&#34;ubicación-de-la-máquina-virtual&#34;&gt;Ubicación de la máquina virtual&lt;/h2&gt;

&lt;p&gt;Otro problema que me he encontrado es que la máquina virtual se crea en la misma carpeta desde donde se lanza el fichero &lt;code&gt;Vagrantfile&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;En Hyper-V se puede definir una ruta por defecto donde almacenar las máquinas virtuales, pero parece que Vagrant ignora esta configuración.&lt;/p&gt;

&lt;p&gt;En el equipo de laboratorio tengo dos discos, un SSD y un disco mecánico y he distribuido las máquinas virtuales según mis preferencias. Así que el hecho de que Vagrant cree las máquinas sin tener en cuenta la configuración del proveedor Hyper-V supone un problema que debería corregir, buscando en la configuración de Vagrant (si es que es posible modificar este comportamiento).&lt;/p&gt;

&lt;h2 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h2&gt;

&lt;p&gt;Mi objetivo es automatizar la creación de una nueva máquina virtual con Docker y/o Kubernetes instalado.&lt;/p&gt;

&lt;p&gt;Tengo dos máquinas virtuales exportadas con Docker y Kubernetes, respectivamente, por lo que Vagrant no aporta nada que no pueda hacer ahora mismo importando las máquinas en Hyper-V.&lt;/p&gt;

&lt;p&gt;Mediante un script en Powershell importo la máquina virtual en Hyper-V con el nombre especificado; no he conseguido hacer lo mismo en Vagrant.&lt;/p&gt;

&lt;p&gt;Personalmente prefiero crear un par de scripts con Powershell para conseguir especificar la IP, el nombre del host, etc que no tener que lidiar con el fichero de configuración de Vagrant.&lt;/p&gt;

&lt;p&gt;Después de importar la máquina o de crearla vía Vagrant, tengo que conectar igualmente a la VM para cambiar el &lt;code&gt;hostname&lt;/code&gt; y especificar una IP estática. Al usar la importación en Hyper-V ya tengo instalado Docker y/o Kubernetes, que en las máquinas creadas con Vagrant debo instalar manualmente.&lt;/p&gt;

&lt;p&gt;No tengo claro si los problemas que he encontrado con Vagrant se deben a mi desconocimiento del producto o a problemas de &lt;em&gt;concepto&lt;/em&gt;. Quizás es el hecho de usar un proveedor diferente al que se usa por defecto (Hyper-V vs VirtualBox) o al hecho de que el equipo donde se ejecutan las máquinas virtuales es diferente al equipo de &lt;em&gt;desarrollo&lt;/em&gt; (por el fichero &lt;code&gt;private_key&lt;/code&gt; para conectar vía SSH).&lt;/p&gt;

&lt;p&gt;En cualquier caso, Vagrant no se adapta a mis necesidades, creando fricción, por lo que seguiré buscando otras soluciones para automatizar la creación de las máquinas virtuales.&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>