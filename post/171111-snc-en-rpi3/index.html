<!DOCTYPE html>
<html ⚡>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="theme-color" content="#263238">

<meta name="generator" content="Hugo 0.68.3" />

<link rel="apple-touch-icon" href="https://onthedock.github.io/images/logo.png">


<link rel="canonical" href="https://onthedock.github.io/post/171111-snc-en-rpi3/">


    
    <link href="https://fonts.googleapis.com/css?family=Lobster|Lato:400,700" rel="stylesheet">
    
    <title>Single node cluster en la RPi3 - On The Dock</title>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    
    <script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script>
<script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
<script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script>

    
<meta name="description" content="&lt;p&gt;En la entrada anterior &lt;a href=&#34;https://onthedock.github.io/post/171104-apiserver-detenido/&#34;&gt;API server detenido: The connection to the server was refused&lt;/a&gt; encontré problemas con la tarjeta microSD que sirve de almacenamiento para el nodo master del clúster de Kubernetes.&lt;/p&gt;&lt;p&gt;La solución al problema pasaba por realizar un análisis de la tarjeta para repararla. Sin embargo, al intentarlo, no ha habido manera de formatear y reinstalar HypriotOS sobre la tarjeta.&lt;/p&gt;&lt;p&gt;El fallo de la tarjeta de memoria ha sido la gota final que me ha hecho abandonar el clúster multinodo en las Raspberry Pi (de momento). Así que he decidido instalar un clúster de un solo nodo en una de las Raspberri Pi 3.&lt;/p&gt;&lt;p&gt;En este artículo sigo las instrucciones oficiales para construir un clúster de Kubernetes usando &lt;em&gt;kubeadm&lt;/em&gt;: &lt;a href=&#34;https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/&#34;&gt;Using kubeadm to Create a Cluster&lt;/a&gt;&lt;/p&gt;">

<meta property="og:title" content="Single node cluster en la RPi3 - On The Dock">
<meta property="og:type" content="article">
<meta property="og:url" content="https://onthedock.github.io/post/171111-snc-en-rpi3/">
<meta property="og:image" content="https://onthedock.github.io/images/kubernetes.png">
<meta property="og:site_name" content="On The Dock">
<meta property="og:description" content="&lt;p&gt;En la entrada anterior &lt;a href=&#34;https://onthedock.github.io/post/171104-apiserver-detenido/&#34;&gt;API server detenido: The connection to the server was refused&lt;/a&gt; encontré problemas con la tarjeta microSD que sirve de almacenamiento para el nodo master del clúster de Kubernetes.&lt;/p&gt;&lt;p&gt;La solución al problema pasaba por realizar un análisis de la tarjeta para repararla. Sin embargo, al intentarlo, no ha habido manera de formatear y reinstalar HypriotOS sobre la tarjeta.&lt;/p&gt;&lt;p&gt;El fallo de la tarjeta de memoria ha sido la gota final que me ha hecho abandonar el clúster multinodo en las Raspberry Pi (de momento). Así que he decidido instalar un clúster de un solo nodo en una de las Raspberri Pi 3.&lt;/p&gt;&lt;p&gt;En este artículo sigo las instrucciones oficiales para construir un clúster de Kubernetes usando &lt;em&gt;kubeadm&lt;/em&gt;: &lt;a href=&#34;https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/&#34;&gt;Using kubeadm to Create a Cluster&lt;/a&gt;&lt;/p&gt;">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="On The Dock">
<meta name="twitter:url" content="https://onthedock.github.io/post/171111-snc-en-rpi3/">
<meta name="twitter:title" content="Single node cluster en la RPi3 - On The Dock">
<meta name="twitter:description" content="&lt;p&gt;En la entrada anterior &lt;a href=&#34;https://onthedock.github.io/post/171104-apiserver-detenido/&#34;&gt;API server detenido: The connection to the server was refused&lt;/a&gt; encontré problemas con la tarjeta microSD que sirve de almacenamiento para el nodo master del clúster de Kubernetes.&lt;/p&gt;&lt;p&gt;La solución al problema pasaba por realizar un análisis de la tarjeta para repararla. Sin embargo, al intentarlo, no ha habido manera de formatear y reinstalar HypriotOS sobre la tarjeta.&lt;/p&gt;&lt;p&gt;El fallo de la tarjeta de memoria ha sido la gota final que me ha hecho abandonar el clúster multinodo en las Raspberry Pi (de momento). Así que he decidido instalar un clúster de un solo nodo en una de las Raspberri Pi 3.&lt;/p&gt;&lt;p&gt;En este artículo sigo las instrucciones oficiales para construir un clúster de Kubernetes usando &lt;em&gt;kubeadm&lt;/em&gt;: &lt;a href=&#34;https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/&#34;&gt;Using kubeadm to Create a Cluster&lt;/a&gt;&lt;/p&gt;">
<meta name="twitter:image" content="https://onthedock.github.io/images/kubernetes.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"https:\/\/onthedock.github.io\/"
    },
    "headline": "Single node cluster en la RPi3 - On The Dock",
    "image": {
      "@type": "ImageObject",
      "url": "https:\/\/onthedock.github.io\/images\/kubernetes.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2017-11-11T12:08:36JST",
    "dateModified": "2017-11-11T12:08:36JST",
    "author": {
      "@type": "Person",
      "name": "On The Dock"
    },
    "publisher": {
      "@type": "Organization",
      "name": "On The Dock",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/onthedock.github.io\/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "\x3cp\x3eEn la entrada anterior \x3ca href=\x22https:\/\/onthedock.github.io\/post\/171104-apiserver-detenido\/\x22\x3eAPI server detenido: The connection to the server was refused\x3c\/a\x3e encontré problemas con la tarjeta microSD que sirve de almacenamiento para el nodo master del clúster de Kubernetes.\x3c\/p\x3e\n\x3cp\x3eLa solución al problema pasaba por realizar un análisis de la tarjeta para repararla. Sin embargo, al intentarlo, no ha habido manera de formatear y reinstalar HypriotOS sobre la tarjeta.\x3c\/p\x3e\n\x3cp\x3eEl fallo de la tarjeta de memoria ha sido la gota final que me ha hecho abandonar el clúster multinodo en las Raspberry Pi (de momento). Así que he decidido instalar un clúster de un solo nodo en una de las Raspberri Pi 3.\x3c\/p\x3e\n\x3cp\x3eEn este artículo sigo las instrucciones oficiales para construir un clúster de Kubernetes usando \x3cem\x3ekubeadm\x3c\/em\x3e: \x3ca href=\x22https:\/\/kubernetes.io\/docs\/setup\/independent\/create-cluster-kubeadm\/\x22\x3eUsing kubeadm to Create a Cluster\x3c\/a\x3e\x3c\/p\x3e"
  }
</script>


    <style amp-custom>
      html { font-size: 18px;}@media (max-width: 768px) { html { font-size: 15px; }}body { font-family: Lato,'Hiragino Kaku Gothic Pro',メイリオ,Meiryo,sans-serif; font-size: inherit; margin: 0; color: #263238;}html, body { margin: 0;}a { text-decoration: none; color: #e91e63;}p { margin: 0;}ul,ol { margin: 0; padding: 0;}h1, h2, h3, h4, h5, h6 { margin: 0; font-weight: 700;}h1 { font-size: 1.8rem; line-height: 2rem; margin: 1.5rem 0; }h2 { font-size: 1.4rem; line-height: 2rem; margin: 1.5rem 0; }h3 { font-size: 1.2rem; line-height: 1.5rem; margin: 1.5rem 0; }h4, h5, h6 { font-size: 1rem; line-height: 1.5rem; margin: 1.5rem 0; }.clearfix::after { content: ''; display: block; clear: both;}main{ display: block;}.searchbar{ display: block; border: none; margin: 1em auto; max-width: 780px; text-align: center;}/* Layouts */.l-header { padding: .5rem 0; margin-bottom: 2rem; border-bottom: 1px dashed #cfd8dc; text-align: center;}.l-footer { font-size: .8rem; padding: 1rem 0; border-top: 1px dashed #cfd8dc;}.l-footer .copyright-notice,.l-footer .attribution { text-align: center;}.l-container { max-width: 42rem; margin: 0 auto; padding: 0 1rem;}/* Parts:logo */.p-logo { font-family: Lobster, cursive;}.p-logo a { color: #000; font-size: 1.6rem; line-height: 2rem;}/* Parts:section */section { border-top: 2px solid #eceff1; padding: 1.5rem 0;}section>header { text-transform: uppercase; font-weight: 700; margin-bottom: 2rem; text-align: center;}section>header span { display: inline-block; background-color: #000; color: #fff; letter-spacing: 3px; font-size: .7rem; padding: .5rem .75rem;}/* Parts:facts */.p-facts { list-style: none; font-size: .8rem; margin-bottom: 1rem;}.p-facts:last-child { margin-bottom: 0;}.p-facts li { display: inline-block; margin-right: .5rem; text-transform: uppercase;}.p-facts li header { margin-bottom: .25rem; font-weight: 700;}.p-facts li header a { color: #000; text-decoration: underline;}.p-facts li li { display: inline-block; margin-right: .5rem;}.p-facts li li::after { content: ',';}.p-facts li li:last-child::after { content: '';}/* Parts:crumb */.p-crumb { list-style: none; margin-bottom: 1rem; font-size: .8rem; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.p-crumb:last-child { margin-bottom: 0;}.p-crumb li { display: inline;}.p-crumb li::after { content: '›'; margin: 0 .5rem;}.p-crumb li:last-child::after { content: '';}/* Parts:page-title */.p-page-title { margin-bottom: 2rem;}.p-page-title .title { margin-bottom: .5rem;}/* Parts:share */.p-share { margin-bottom: 1.5rem; text-align: center;}.p-share a { display: inline-block; text-align: center; padding: .5rem .5rem; margin-right: .25rem; font-size: .6rem; background-color: #eceff1; font-weight: 700;}.p-share a.ht { color: #00a4de; }.p-share a.fb { color: #3b5998; }.p-share a.tw { color: #1da1f2; }.p-share a.ln { color: #00c300; }.p-share a.ht::before { content: 'Hatena'; }.p-share a.fb::before { content: 'Facebook'; }.p-share a.tw::before { content: 'Twitter'; }.p-share a.ln::before { content: 'LINE'; }/* Parts:terms */.p-terms { padding-left: 2rem;}/* Parts:paginator */.p-paginator { text-align: center; margin-bottom: 3rem; padding-top: 2rem;}.p-paginator a { display: inline-block; border: 2px solid #eceff1; color: #263238; line-height: 2rem; padding: 0 1rem;}/* Parts:article */.p-articles { list-style: none;}.p-articles>li { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px dashed #cfd8dc;}.p-articles>li:last-child { border-bottom: none; padding-bottom: 0;}.p-articles.thin>li { margin-bottom: 1rem; padding-bottom: 1rem;}article .article-header { display: table-cell; height: 6rem; vertical-align: middle;}article .title { margin: 0; margin-bottom: .5rem; font-size: 1.4rem; line-height: 2rem;}article .title a { color: #000;}article .header-wrapper { margin-bottom: 1.5rem;}article .thumbnail { display: block; background-position: center; background-size: cover; background-image: url(https://onthedock.github.io/images/default.jpg); width: 6rem; height: 6rem; border-radius: 50%; box-shadow: 0 0 3px 0 #333 inset; float: left; margin-right: 1rem;}article .summary { margin-bottom: 1.5rem;}article .readmore { text-align: center;}article .readmore a { font-size: .8rem; color: #000; text-decoration: underline;}article.li.sm .header-wrapper { margin-bottom: 0;}.article-body h2 { padding: 1rem 0; color: #55bbbb; border-bottom: 2px solid #eceff1;}.article-body h2:first-child { margin-top: 0; }.article-body h3 { color: #8997e4; font-style: italic;}.article-body h4 { border-left: solid .25rem #cddc39; padding: 0 .5rem;}.article-body p { margin: 1.5rem 0; line-height: 1.5rem;}.article-body a { text-decoration: underline;}.article-body ul,.article-body ol { padding-left: 1.5rem;}.article-body li { line-height: 2rem;}.article-body code { display: inline-block; font-family: Menlo, consolas, monospace; background-color: #eceff1; font-size: .8rem; padding: 0 .5rem; line-height: 1.5rem;}.article-body pre { margin: 1.5rem 0; padding: 1.5rem; font-size: .8rem; background-color: #eeeeef; color: #444; overflow: auto;}.article-body pre code { background-color: transparent;}.article-body blockquote { /* margin: 1.2rem 0; padding: .5rem 0; */ /*font-size: .8rem;*/ border-top: 1px solid #eceff1; border-bottom: 1px solid #eceff1; color: #607d8b;}.article-body blockquote p { margin: .5rem 0; line-height: 1.5rem;}.article-body strong { /*box-shadow: 0 -.5rem 0 0 #f06292 inset;*/ font-style: bold; font-weight: 700; /*color: #ff5722; */}.article-body em { /*font-style: normal;*/ /*font-weight: 700; color: #00c300;*/ /*color: #00c300;*/ font-style: oblique;}.article-body figure { margin: 1.5rem -2rem; }.article-body figure.left,.article-body figure.right { width: 15rem; height: 12rem; margin-top: 0; margin-left: 0; margin-right: 0;}.article-body figure.left { float: left; margin-right: 1rem; margin-left: -2rem; }.article-body figure.right { float: right; margin-left: 1rem; margin-right: -2rem; }@media (max-width: 768px) { .article-body figure { margin: 1.5rem -1rem; } .article-body figure.left, .article-body figure.right { float: none; margin: 0 -1rem; width: auto; height: auto; }}.article-body figcaption { padding: .5rem 0; font-size: .8rem; text-align: center;}.article-body figcaption a { color: #263238;}

       .article-4c8c13dd5627da332e5774b27cf40099 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-6e92220fbd4bf73e9add44ea35db7875 .thumbnail { background-image: url(https://onthedock.github.io/images/cloud-init.png);  }  .article-65945fdc2f7a451d2eba88e27bcae615 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-d4ae75e268955792710fe6fdbf38a8cd .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-f875614400506b86e2eed3af9535c6f0 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-70ddbb73f4be0ef264658d45b44a1501 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-af7ce20f88530a679b64bc11f369dd66 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-749180de0a0f927ac4118d5f742aec7a .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-eabbba2a574b52017ab09aadb1e27892 .thumbnail { background-image: url(https://onthedock.github.io/images/git.png);  }  .article-4df08a53150d4f7d2766c8debd1831a3 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-ae823e9b9f3db0ab3a477ed5e16bcb32 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-9e165e5c05a4125a00ec1ec5048a7d4c .thumbnail { background-image: url(https://onthedock.github.io/images/git.png);  }  .article-0b46f42d26003d0a8a0c0a8792e872c3 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-bf486333bdc41366eb67ebcd83df7dfd .thumbnail { background-image: url(https://onthedock.github.io/images/okd.png);  }  .article-5b04a4598c80921d43637c7023ad4877 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-6548eb3cdf7ceb97a246efd3d61b22ae .thumbnail { background-image: url(https://onthedock.github.io/images/code.jpg);  }  .article-67ffd386f3fb60aa875a1b304dcbd33c .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-fdbe83149bbb772c83e8270b925cba5f .thumbnail { background-image: url(https://onthedock.github.io/images/code.jpg);  }  .article-fa396b4de84b2dfd9b95c5edfc10cc30 .thumbnail { background-image: url(https://onthedock.github.io/images/python.png);  }  .article-296c831bcc1b030d00b8ee27e96a5226 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-b2b753da998b1936d8c475787c1de07f .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-b95004b4126fa41395385c5e37f31081 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-a8fd68175b85c6ab1e57dd164e56c25e .thumbnail { background-image: url(https://onthedock.github.io/images/MabelAmber-mini.png);  }  .article-cd0ad924309bc0e2310a28f4574f3ee6 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-c4149a0be2e1a3d215d0b9dbb1340cad .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-c04747c53dc824266e9428efb65f072d .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-c6d431118f1f3fa0e4ec3e6e454bb634 .thumbnail { background-image: url(https://onthedock.github.io/images/roadmap.png);  }  .article-1ce4351c9635f2cadcc6057dd96238d9 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-8cb097c83a6ec6e1fe01c4278c8a35c6 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-22355649e0a434b67e571674216e1e54 .thumbnail { background-image: url(https://onthedock.github.io/images/aws.png);  }  .article-23858711b322c88a48f2b2d742a36f3d .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-d92b1a0387e28368be9738f69f1aa7ce .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-98124356b113c2a6917683aca3c29a99 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-a093ac0f1b7268afeade39452595d2f1 .thumbnail { background-image: url(https://onthedock.github.io/images/bug.png);  }  .article-38834ecfa3e2f37d5a70e6884d71074a .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-932932e45567c9f06aca44ce87e2a385 .thumbnail { background-image: url(https://onthedock.github.io/images/bug.png);  }  .article-c1ca90597f186bd1ad8bb1c94f4a447a .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-765192a6c291e47974a12dcf8924d8db .thumbnail { background-image: url(https://onthedock.github.io/images/ansible.png);  }  .article-b764fa70c94a1d2fd4fd14237d21967d .thumbnail { background-image: url(https://onthedock.github.io/images/python.png);  }  .article-f68c36fc2fb55e32944f45e490e5e5e9 .thumbnail { background-image: url(https://onthedock.github.io/images/ansible.png);  }  .article-bd81d8ba70bc61639103fb97b7490aed .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-1c63237c8383a2e30ee2e3fcc7150643 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-c0152a70142649803b63b10edd4921d3 .thumbnail { background-image: url(https://onthedock.github.io/images/asciidoctor.png);  }  .article-396652c83bff211b566a6a3fd5bf1913 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-bde56cbd0283e6a7909a444b8e08e5c5 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-0c530d26aef03bb376ea14c3014c0325 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-0d445519a7825dfd55db94b8b9817031 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-a57735573e4d2b1c48a69a09a73878b7 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-ccf02aadbf150df00f9a2962c5cc2c32 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-b4fa6645c244835f679427bd29ec86fb .thumbnail { background-image: url(https://onthedock.github.io/images/190101/amazonlinux.png);  }  .article-1f90092555e2ba74f132561ef66df1d5 .thumbnail { background-image: url(https://onthedock.github.io/images/ansible.png);  }  .article-702ecd15d93c0a640329570a1515ec22 .thumbnail { background-image: url(https://onthedock.github.io/images/181124/roadmap.png);  }  .article-fe261e0b7d326a141c1ff662c1caf421 .thumbnail { background-image: url(https://onthedock.github.io/images/cloud-init.png);  }  .article-2fc7b42f0ad38b1d0c3bda16184154ed .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-9a5a658f072f34635bd665eae7d0d498 .thumbnail { background-image: url(https://onthedock.github.io/images/docker-compose.jpg);  }  .article-f8770956a383aeb68930a558bae85310 .thumbnail { background-image: url(https://onthedock.github.io/images/automation.png);  }  .article-d27d7b7a4057230acbe88420832d3a67 .thumbnail { background-image: url(https://onthedock.github.io/images/gitea.jpg);  }  .article-365473b8c27877be27245e38a5feb95c .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-8da35239d2403351cd1910b3939787f6 .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-4f389af4c69dce1f727b95af66218cc0 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-b63b63041915fd06eb96d2d6b298ac9b .thumbnail { background-image: url(https://onthedock.github.io/images/sonarqube.png);  }  .article-db94723578a25efdcd1489b628ae77c9 .thumbnail { background-image: url(https://onthedock.github.io/images/sonarqube.png);  }  .article-92e6838a86f3c412b36d6abbbb0f3f77 .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-8fd0d0535b25566772d8bfcab456999e .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-9d852d24f77755909ea56d2ce72cb408 .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-015f92caa0da0be71b6008713be0e15f .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-b40404c5768e20c9cf4a0ef9b40d5d8c .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-56679bf127fa712be78799b59e8ebcbe .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-c926846ccb5ddda2e607d41a7eed1e7e .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-439d0c4b480f76cd3e4e59c497020808 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-ca9a82a3e9074b202ea71b79b8f06d72 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-5dd2fbecd3c1861b16d6ccbae8458692 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-d27ecb2023ff85d0423abc98d4d8ded4 .thumbnail { background-image: url(https://onthedock.github.io/images/portainer.png);  }  .article-82fdfab1e200b6fc1a28801ee717993c .thumbnail { background-image: url(https://onthedock.github.io/images/jenkins.png);  }  .article-ff3cf8144aa52ea6d7195126da8ce676 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-88a2b37925efc71e7f9ec017570e19f0 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-f22b7fd29e14db2fbd6cd579c2a0d5c9 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-fc9c9a2b1dcd0c5683f7adbafda8f7c8 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-a45fe2c1cdbadc45cbf34a63ab37ebcc .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-9e27e7f162c2feae804cbc006c1c9349 .thumbnail { background-image: url(https://onthedock.github.io/images/MabelAmber-mini.png);  }  .article-2a7b6b0759e163accb88c9261e4c0bbf .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-340e5d68f76888b0b8debb38ef25d46b .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-2fc73bdfb18aaf2eb89944fb4f7d53de .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-70a1a0028c7c78526f004c0e3218a2b3 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-f81b2bb759a18deaa3b5575087686fe7 .thumbnail { background-image: url(https://onthedock.github.io/images/gogs.png);  }  .article-156dcec052e59d7d9f0de2250fda46f4 .thumbnail { background-image: url(https://onthedock.github.io/images/dokuwiki-on-docker.png);  }  .article-f831baebaad56b8e3d70750749393da3 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-df14f92fc6edab1c8632e66ef7c7e5a6 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-516ab75e14eb7886aaab03ff75dbfc6b .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-d1ead2ec3d26cb7f91ef8234915eb13f .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-0b9c6f0820f2306f6cc2bfd170dccb8e .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-1cbc9cfd0ad3798b23d19eac020b3153 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-a32274b07ce43fef61c7f19e4b68f650 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-9b0b3a180af20b5c091134d23cb6d383 .thumbnail { background-image: url(https://onthedock.github.io/images/minio.jpg);  }  .article-b20735633157cb1e57eb0c1d05406149 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-d1e335a06f765bffda53d2e123044b27 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-c36c64b9d6ce0d2c95381976831c3160 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-ee7d8acecc9de179b9d1cecb3d253215 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-2480be47fe45cfc13b07c86c32ed8cda .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-99a6578fdc273f40a61d182bcb5917c4 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-3ffff09a2dd1f953bbb8624d88756829 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-0a9cef5c4637bd946188e37439fef69c .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-42a206d287914317761f7749b964ddb2 .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-85dee6c250520e561ebc93740f1d514f .thumbnail { background-image: url(https://onthedock.github.io/images/alpine.png);  }  .article-a65000ba68f97000bb927be3f88f75bd .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-2de6ff3b0144ea18b2ef056107448a33 .thumbnail { background-image: url(https://onthedock.github.io/images/yaml.png);  }  .article-a8aea2191f0d8d238ab6217feba51ac3 .thumbnail { background-image: url(https://onthedock.github.io/images/vagrant.png);  }  .article-67cd76b76e108b6604b344e92a3c329a .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-d341a5f8cd54b9da7a3a6d1168365c25 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-59e1fe22eaedce05afe517780f87cc98 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-87ee3835fe3b255e8566c3bfed2bd38b .thumbnail { background-image: url(https://onthedock.github.io/images/portainer.png);  }  .article-086bb6242700303c8a958c5e74df0ca9 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-4c6b9124141ca1a8135b9177248b7e15 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-911698c11286b3ef9eb1a11440c09845 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-6a0861472d6f0696079c81e3710d5fe8 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-40b8655184d8e4a2ca3650aece49e845 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-857a5f627557e7d92f1386f7c6e04dee .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-4db85da082f771e8fb9029adad4173ec .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-b69159ccecf58bff548bbd08481b6e15 .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-da222607e970c37b0b59d8011a2e3398 .thumbnail { background-image: url(https://onthedock.github.io/images/portainer.png);  }  .article-7b36708a64c36890ceb1bf481f3de1fa .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-d68e08dcca5eafff4ae0d8d06280bf02 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-8ff87e4d24c357bbee842dd088ef4cde .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-d0ca4b0abe6c0c6d22baa800e3fc9935 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-63c13529eb1936073e0adc09d7e35b59 .thumbnail { background-image: url(https://onthedock.github.io/images/kubernetes.png);  }  .article-2e821bde62a219fe0b94f62e989269e7 .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-df564c824db9099fd85c925ad9635cda .thumbnail { background-image: url(https://onthedock.github.io/images/raspberry_pi.png);  }  .article-203d2d443889d9d70ca2ad9abcca49aa .thumbnail { background-image: url(https://onthedock.github.io/images/docker.png);  }  .article-526bade0815ac377e81216604b97c5f7 .thumbnail { background-image: url(https://onthedock.github.io/images/github.png);  }  .article-3d9c586728a0009cb0621b0368120462 .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-160ee3ec04bb73e590f125b42640b34b .thumbnail { background-image: url(https://onthedock.github.io/images/hugo.png);  }  .article-c862ac2fb3511b386b4247a80aa6b90b .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-8a50a2d4216b1a3b2b46c646bd24c5e9 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-f027d2889032f918da8e3cc9c03169e0 .thumbnail { background-image: url(https://onthedock.github.io/images/linux.png);  }  .article-6db4ecfe853552466ce5a71b1221a2a0 .thumbnail { background-image: url(https://onthedock.github.io/images/hypriot.png);  } 
    </style>
  </head>

  <body>
    
    
    

    <header class="l-header">
      <div class="l-container">
        <div class="h-logo p-logo">
          <a href="https://onthedock.github.io/" class="h-logo">On The Dock</a>
          <p class="h-logo">Un blog sobre el Cloud, Kubernetes, DevOps, Docker y Raspberry Pi por Xavier Aznar</p>
        </div>
      </div>
    </header>

    <main>
      
<div class="l-container">
  <article class="single article-70a1a0028c7c78526f004c0e3218a2b3">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/171111-snc-en-rpi3/" class="thumbnail" title="Single node cluster en la RPi3"></a>
    <header class="article-header">
      <div class="clearfix">
        <h1 class="title">Single node cluster en la RPi3</h1>
        <ul class="p-facts">
          <li><time datetime="2017-11-11T12:08:36JST">11 Nov 2017</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
          <li>Xavier Aznar</li>
        </ul>
      </div>
    </header>
  </div>

  <div class="article-body"><p>En la entrada anterior <a href="https://onthedock.github.io/post/171104-apiserver-detenido/">API server detenido: The connection to the server was refused</a> encontré problemas con la tarjeta microSD que sirve de almacenamiento para el nodo master del clúster de Kubernetes.</p>
<p>La solución al problema pasaba por realizar un análisis de la tarjeta para repararla. Sin embargo, al intentarlo, no ha habido manera de formatear y reinstalar HypriotOS sobre la tarjeta.</p>
<p>El fallo de la tarjeta de memoria ha sido la gota final que me ha hecho abandonar el clúster multinodo en las Raspberry Pi (de momento). Así que he decidido instalar un clúster de un solo nodo en una de las Raspberri Pi 3.</p>
<p>En este artículo sigo las instrucciones oficiales para construir un clúster de Kubernetes usando <em>kubeadm</em>: <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/">Using kubeadm to Create a Cluster</a></p>
<p>Las instrucciones en la página oficial de Kubernetes son precisas y no hace falta realizar ninguna adaptación o modificación para instalar Kubernetes en una Raspberry Pi con Hypriot OS.</p>
<p>Para poder instalar Kubernetes usando <em>kubeadm</em>, el primer requerimiento es tener instalado <em>kubeadm</em>. Las instrucciones para instalarlo se encuentran en <a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/">Installing kubeadm</a>.</p>
<p>Los requerimientos para poder instalar <em>kubeadm</em> y Kubernetes ya se dan en Hypriot OS (por ejemplo, tener desactivada la <em>swap</em>).</p>
<p>HypriotOS también viene equipado de serie con Docker:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker version
Client:
 Version:      17.05.0-ce
 API version:  1.29
 Go version:   go1.7.5
 Git commit:   89658be
 Built:        Thu May  <span style="color:#ae81ff">4</span> 22:30:54 <span style="color:#ae81ff">2017</span>
 OS/Arch:      linux/arm

Server:
 Version:      17.05.0-ce
 API version:  1.29 <span style="color:#f92672">(</span>minimum version 1.12<span style="color:#f92672">)</span>
 Go version:   go1.7.5
 Git commit:   89658be
 Built:        Thu May  <span style="color:#ae81ff">4</span> 22:30:54 <span style="color:#ae81ff">2017</span>
 OS/Arch:      linux/arm
 Experimental: false
</code></pre></div><p>El  siguiente paso es instalar <em>kubeadm</em>, <em>kubelet</em> y <em>kubectl</em>. Para ello, primero nos convertimos en el usuario <code>root</code> mediante:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo -i
</code></pre></div><p>Actualizamos el índice de paquetes e instalamos <code>apt-transport-https</code> (aunque HypriotOS también los trae de fábrica):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install -y apt-transport-https
Get:1 http://mirrordirector.raspbian.org jessie InRelease <span style="color:#f92672">[</span>14.9 kB<span style="color:#f92672">]</span>
Get:2 http://archive.raspberrypi.org jessie InRelease <span style="color:#f92672">[</span>22.9 kB<span style="color:#f92672">]</span>
...
Reading state information... Done
apt-transport-https is already the newest version.
<span style="color:#ae81ff">0</span> upgraded, <span style="color:#ae81ff">0</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">41</span> not upgraded.
</code></pre></div><p>Instalamos la clave pública del repositorio de Google, añadimos el repositorio de Kubernetes, actualiazamos e instalamos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
OK
$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list
</span><span style="color:#e6db74">&gt; deb http://apt.kubernetes.io/ kubernetes-xenial main
</span><span style="color:#e6db74">&gt; EOF</span>
$ apt-get update
Hit http://mirrordirector.raspbian.org jessie InRelease
Hit https://apt.dockerproject.org raspbian-jessie InRelease
...
Fetched 15.1 kB in 14s <span style="color:#f92672">(</span><span style="color:#ae81ff">1056</span> B/s<span style="color:#f92672">)</span>
Reading package lists... Done
</code></pre></div><p>Lanzamos la instalación:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ apt-get install -y kubelet kubeadm kubectl
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
  ebtables kubernetes-cni socat
The following NEW packages will be installed:
  ebtables kubeadm kubectl kubelet kubernetes-cni socat
<span style="color:#ae81ff">0</span> upgraded, <span style="color:#ae81ff">6</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">41</span> not upgraded.
Need to get 46.7 MB of archives.
After this operation, <span style="color:#ae81ff">321</span> MB of additional disk space will be used.
Get:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main ebtables armhf 2.0.10.4-3 <span style="color:#f92672">[</span>97.1 kB<span style="color:#f92672">]</span>
...
Fetched 46.7 MB in 22s <span style="color:#f92672">(</span><span style="color:#ae81ff">2077</span> kB/s<span style="color:#f92672">)</span>
...
Selecting previously unselected package ebtables.
<span style="color:#f92672">(</span>Reading database ... <span style="color:#ae81ff">20831</span> files and directories currently installed.<span style="color:#f92672">)</span>
Preparing to unpack .../ebtables_2.0.10.4-3_armhf.deb ...
Unpacking ebtables <span style="color:#f92672">(</span>2.0.10.4-3<span style="color:#f92672">)</span> ...
Selecting previously unselected package kubernetes-cni.
Preparing to unpack .../kubernetes-cni_0.5.1-00_armhf.deb ...
Unpacking kubernetes-cni <span style="color:#f92672">(</span>0.5.1-00<span style="color:#f92672">)</span> ...
Selecting previously unselected package socat.
Preparing to unpack .../socat_1.7.2.4-2_armhf.deb ...
Unpacking socat <span style="color:#f92672">(</span>1.7.2.4-2<span style="color:#f92672">)</span> ...
Selecting previously unselected package kubelet.
Preparing to unpack .../kubelet_1.8.2-00_armhf.deb ...
Unpacking kubelet <span style="color:#f92672">(</span>1.8.2-00<span style="color:#f92672">)</span> ...
Selecting previously unselected package kubectl.
Preparing to unpack .../kubectl_1.8.2-00_armhf.deb ...
Unpacking kubectl <span style="color:#f92672">(</span>1.8.2-00<span style="color:#f92672">)</span> ...
Selecting previously unselected package kubeadm.
Preparing to unpack .../kubeadm_1.8.2-00_armhf.deb ...
Unpacking kubeadm <span style="color:#f92672">(</span>1.8.2-00<span style="color:#f92672">)</span> ...
Processing triggers <span style="color:#66d9ef">for</span> systemd <span style="color:#f92672">(</span>215-17+deb8u7<span style="color:#f92672">)</span> ...
Processing triggers <span style="color:#66d9ef">for</span> man-db <span style="color:#f92672">(</span>2.7.0.2-5<span style="color:#f92672">)</span> ...
Setting up ebtables <span style="color:#f92672">(</span>2.0.10.4-3<span style="color:#f92672">)</span> ...
update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults
Setting up kubernetes-cni <span style="color:#f92672">(</span>0.5.1-00<span style="color:#f92672">)</span> ...
Setting up socat <span style="color:#f92672">(</span>1.7.2.4-2<span style="color:#f92672">)</span> ...
Setting up kubelet <span style="color:#f92672">(</span>1.8.2-00<span style="color:#f92672">)</span> ...
Setting up kubectl <span style="color:#f92672">(</span>1.8.2-00<span style="color:#f92672">)</span> ...
Setting up kubeadm <span style="color:#f92672">(</span>1.8.2-00<span style="color:#f92672">)</span> ...
Processing triggers <span style="color:#66d9ef">for</span> systemd <span style="color:#f92672">(</span>215-17+deb8u7<span style="color:#f92672">)</span> ...
</code></pre></div><h2 id="inicializando-el-clúster">Inicializando el clúster</h2>
<p>Tras el paso previo de la instalación de <em>kubeadm</em>, lanzamos <code>kubeadm init</code>, que inicializa el clúster.</p>
<p>En primer lugar, <em>kubeadm</em> realiza comprobaciones antes de lanzar la descargar de las diferentes imágenes de los elementos del <em>control plane</em> (lo que puede llevar más o menos tiempo, en función de la velocidad de tu conexión). Finalmente, <em>kubeadm</em> muestra instrucciones sobre los siguientes pasos a seguir tras la inicialización del clúster:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubeadm init
<span style="color:#f92672">[</span>kubeadm<span style="color:#f92672">]</span> WARNING: kubeadm is in beta, please <span style="color:#66d9ef">do</span> not use it <span style="color:#66d9ef">for</span> production clusters.
<span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> Using Kubernetes version: v1.8.2
<span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> Using Authorization modes: <span style="color:#f92672">[</span>Node RBAC<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks
<span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> WARNING: docker version is greater than the most recently validated version. Docker version: 17.05.0-ce. Max validated version: 17.03
<span style="color:#f92672">[</span>kubeadm<span style="color:#f92672">]</span> WARNING: starting in 1.8, tokens expire after <span style="color:#ae81ff">24</span> hours by default <span style="color:#f92672">(</span><span style="color:#66d9ef">if</span> you require a non-expiring token use --token-ttl 0<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated ca certificate and key.
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated apiserver certificate and key.
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> apiserver serving cert is signed <span style="color:#66d9ef">for</span> DNS names <span style="color:#f92672">[</span>snc kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local<span style="color:#f92672">]</span> and IPs <span style="color:#f92672">[</span>10.96.0.1 192.168.1.12<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated apiserver-kubelet-client certificate and key.
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated sa key and public key.
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated front-proxy-ca certificate and key.
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Generated front-proxy-client certificate and key.
<span style="color:#f92672">[</span>certificates<span style="color:#f92672">]</span> Valid certificates and keys now exist in <span style="color:#e6db74">&#34;/etc/kubernetes/pki&#34;</span>
<span style="color:#f92672">[</span>kubeconfig<span style="color:#f92672">]</span> Wrote KubeConfig file to disk: <span style="color:#e6db74">&#34;admin.conf&#34;</span>
<span style="color:#f92672">[</span>kubeconfig<span style="color:#f92672">]</span> Wrote KubeConfig file to disk: <span style="color:#e6db74">&#34;kubelet.conf&#34;</span>
<span style="color:#f92672">[</span>kubeconfig<span style="color:#f92672">]</span> Wrote KubeConfig file to disk: <span style="color:#e6db74">&#34;controller-manager.conf&#34;</span>
<span style="color:#f92672">[</span>kubeconfig<span style="color:#f92672">]</span> Wrote KubeConfig file to disk: <span style="color:#e6db74">&#34;scheduler.conf&#34;</span>
<span style="color:#f92672">[</span>controlplane<span style="color:#f92672">]</span> Wrote Static Pod manifest <span style="color:#66d9ef">for</span> component kube-apiserver to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/kube-apiserver.yaml&#34;</span>
<span style="color:#f92672">[</span>controlplane<span style="color:#f92672">]</span> Wrote Static Pod manifest <span style="color:#66d9ef">for</span> component kube-controller-manager to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/kube-controller-manager.yaml&#34;</span>
<span style="color:#f92672">[</span>controlplane<span style="color:#f92672">]</span> Wrote Static Pod manifest <span style="color:#66d9ef">for</span> component kube-scheduler to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/kube-scheduler.yaml&#34;</span>
<span style="color:#f92672">[</span>etcd<span style="color:#f92672">]</span> Wrote Static Pod manifest <span style="color:#66d9ef">for</span> a local etcd instance to <span style="color:#e6db74">&#34;/etc/kubernetes/manifests/etcd.yaml&#34;</span>
<span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to boot up the control plane as Static Pods from directory <span style="color:#e6db74">&#34;/etc/kubernetes/manifests&#34;</span>
<span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> This often takes around a minute; or longer <span style="color:#66d9ef">if</span> the control plane images have to be pulled.
<span style="color:#f92672">[</span>apiclient<span style="color:#f92672">]</span> All control plane components are healthy after 1075.017001 seconds
<span style="color:#f92672">[</span>uploadconfig<span style="color:#f92672">]</span> Storing the configuration used in ConfigMap <span style="color:#e6db74">&#34;kubeadm-config&#34;</span> in the <span style="color:#e6db74">&#34;kube-system&#34;</span> Namespace
<span style="color:#f92672">[</span>markmaster<span style="color:#f92672">]</span> Will mark node snc as master by adding a label and a taint
<span style="color:#f92672">[</span>markmaster<span style="color:#f92672">]</span> Master snc tainted and labelled with key/value: node-role.kubernetes.io/master<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> Using token: fac7e9.cb99bb58fed9ad44
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order <span style="color:#66d9ef">for</span> nodes to get long term certificate credentials
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> Configured RBAC rules to allow certificate rotation <span style="color:#66d9ef">for</span> all node client certificates in the cluster
<span style="color:#f92672">[</span>bootstraptoken<span style="color:#f92672">]</span> Creating the <span style="color:#e6db74">&#34;cluster-info&#34;</span> ConfigMap in the <span style="color:#e6db74">&#34;kube-public&#34;</span> namespace
<span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: kube-dns
<span style="color:#f92672">[</span>addons<span style="color:#f92672">]</span> Applied essential addon: kube-proxy

Your Kubernetes master has initialized successfully!

To start using your cluster, you need to run <span style="color:#f92672">(</span>as a regular user<span style="color:#f92672">)</span>:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run <span style="color:#e6db74">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
  http://kubernetes.io/docs/admin/addons/

You can now join any number of machines by running the following on each node
as root:

  kubeadm join --token fac7e9.cb99bb58fed9ad44 192.168.1.12:6443 --discovery-token-ca-cert-hash sha256:03052b3455bba2e4d9713f55831807c5d6ad69525398620d889586ba2ab663b1
</code></pre></div><p>Como puedes ver en la salida del comando <code>kubeadm init</code>, para poder utilizar <em>kubectl</em> como un usuario sin privilegios, debes copiar (como usuario, no como <code>root</code>) la configuración de Kubernetes a tu carpeta <code>$HOME</code>.</p>
<p>Realizaremos estas acciones una vez hayamos finalizado la instalación de la red para los <em>pods</em>. La red <strong>debe desplegarse antes que cualquier aplicación en el nodo</strong>.</p>
<p>Si queremos unir nodos adicionales al clúster, podemos apuntar el <em>token</em> generado para ello. En este caso nuestro clúster sólo va a tener un nodo, por lo que no será necesario usar el token.</p>
<p>En cualquier caso, puedes recuperar el <em>token</em> para usarlo en cualquier otro momento como explicaba en la entrada <a href="https://onthedock.github.io/post/170417-como-agregar-un-nodo-a-un-cluster-kubernetes/">Cómo agregar un nodo a un cluster Kubernetes</a></p>
<blockquote>
<p>El descubrimiento basado en <em>tokens</em> es el método por defecto en Kubernetes 1.8; el parámetro <code>--discovery-token-ca-cert-hash</code> no era requerido en versiones anteriores. Puedes leer más en <a href="https://kubernetes.io/docs/admin/kubeadm/">kubeadm Setup Tool Reference Guide</a></p>
</blockquote>
<h2 id="instalación-de-la-red-de-_pods_">Instalación de la red de <em>pods</em></h2>
<p>Después de los problemas que tuve en el pasado con <em>Flannel</em>, siempre instalado Weave como red para los <em>pods</em> en mis clústers.</p>
<p>La instalación de la red de <em>pods</em> de Weave Net puedes encontrarla en el enlace <a href="https://www.weave.works/docs/net/latest/kubernetes/kube-addon/">Integrating Kubernetes via the Addon</a> de la lista de <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">Add-Ons</a> de Kubernetes.</p>
<blockquote>
<p>El comando de instalación de Weave Net requiere Kubernetes 1.4 o superior</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl apply -f <span style="color:#e6db74">&#34;https://cloud.weave.works/k8s/net?k8s-version=</span><span style="color:#66d9ef">$(</span>kubectl version | base64 | tr -d <span style="color:#e6db74">&#39;\n&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
serviceaccount <span style="color:#e6db74">&#34;weave-net&#34;</span> created
clusterrole <span style="color:#e6db74">&#34;weave-net&#34;</span> created
clusterrolebinding <span style="color:#e6db74">&#34;weave-net&#34;</span> created
daemonset <span style="color:#e6db74">&#34;weave-net&#34;</span> created
</code></pre></div><h2 id="habilita-_kubectl_-para-usuarios-sin-privilegios">Habilita <em>kubectl</em> para usuarios sin privilegios</h2>
<p>Una vez hemos finalizado la instalación e inicialización del nodo master, nos deshacemos de los privilegios de <code>root</code> y realizamos la copia del fichero de configuración de <em>kubectl</em> para poder usarlo como un usuario &ldquo;normal&rdquo;:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</code></pre></div><p>Verificamos que funciona lanzando, por ejemplo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get pods --all-namespaces
NAMESPACE     NAME                          READY     STATUS              RESTARTS   AGE
kube-system   etcd-snc                      1/1       Running             <span style="color:#ae81ff">0</span>          26m
kube-system   kube-apiserver-snc            1/1       Running             <span style="color:#ae81ff">0</span>          26m
kube-system   kube-controller-manager-snc   1/1       Running             <span style="color:#ae81ff">0</span>          18m
kube-system   kube-dns-66ffd5c588-xrb6m     0/3       Pending             <span style="color:#ae81ff">0</span>          18m
kube-system   kube-proxy-ppwxd              1/1       Running             <span style="color:#ae81ff">0</span>          18m
kube-system   kube-scheduler-snc            1/1       Running             <span style="color:#ae81ff">0</span>          26m
kube-system   weave-net-mq5pz               0/2       ContainerCreating   <span style="color:#ae81ff">0</span>          46s
</code></pre></div><blockquote>
<p>En la salida del comando vemos que el DNS interno todavía está pendiente de la creación de los contenedores de la red de <em>pods</em> de Weave Net.</p>
</blockquote>
<h2 id="habilitar-el-despliegue-de-_pods_-en-el-nodo-master">Habilitar el despliegue de <em>pods</em> en el nodo master</h2>
<p>Por defecto, el planificador (<em>scheduler</em>) de Kubernetes sólo asigna <em>pods</em> en los nodos <em>worker</em>.</p>
<p>Para cambiar el comportamiento por defecto y poder usar la Raspberry Pi como un clúster de un solo nodo (con roles Master y Worker), usamos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl taint nodes --all node-role.kubernetes.io/master-
node <span style="color:#e6db74">&#34;snc&#34;</span> untainted
</code></pre></div><h2 id="resumen">Resumen</h2>
<p>En esta entrada hemos instalado y configurado el nodo master de una instalación de Kubernetes usando <em>kubeadm</em>. Una vez finalizada la inicialización del clúster, hemos eliminado el <em>taint</em> en el nodo para que puedan desplegarse <em>pods</em> en este nodo, convirtiendo la Raspberry Pi en un clúster de Kubernetes de un solo nodo.</p></div>

  <aside class="p-share">
  <a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fonthedock.github.io%2fpost%2f171111-snc-en-rpi3%2f&text=Single%20node%20cluster%20en%20la%20RPi3&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fonthedock.github.io%2fpost%2f171111-snc-en-rpi3%2f&t=Single%20node%20cluster%20en%20la%20RPi3" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://line.me/R/msg/text/?Single%20node%20cluster%20en%20la%20RPi3 https%3a%2f%2fonthedock.github.io%2fpost%2f171111-snc-en-rpi3%2f" title="LINEでシェア" class="ln" target="_blank" rel="nofollow"></a>
  <a href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fonthedock.github.io%2fpost%2f171111-snc-en-rpi3%2f&title=Single%20node%20cluster%20en%20la%20RPi3" title="はてなブックマーク" class="ht" target="_blank" rel="nofollow"></a>
  <div class="searchbar">
      <iframe src="https://duckduckgo.com/search.html?site=https://onthedock.github.io/&prefill=Busca en este sitio usando DuckDuckGo" style="width: 25em;height: 48px" frameborder="0"></iframe>
    </div>
</aside>


  <footer class="article-footer">
    <section>
      <ol class="p-crumb">
        <li><a href="https://onthedock.github.io/">On The Dock</a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://onthedock.github.io/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li>Single node cluster en la RPi3</li>
      </ol>

      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="https://onthedock.github.io/categories/">categories</a></header>
          <ul>
            
            <li><a href="https://onthedock.github.io/categories/dev/">dev</a></li>
            
            <li><a href="https://onthedock.github.io/categories/ops/">ops</a></li>
            
          </ul>
        </li>
      </ul>
      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="https://onthedock.github.io/tags/">tags</a></header>
          <ul>
            
            <li><a href="https://onthedock.github.io/tags/raspberry-pi/">raspberry pi</a></li>
            
            <li><a href="https://onthedock.github.io/tags/linux/">linux</a></li>
            
            <li><a href="https://onthedock.github.io/tags/kubernetes/">kubernetes</a></li>
            
          </ul>
        </li>
      </ul>
      
      
    </section>
  </footer>
</article>

<article>
  <div id="disqus_thread"></div>
  <script>
  
  

  

  (function() { 
  var d = document, s = d.createElement('script');
  s.src = 'https://onthedock.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                              

</article>



  
  
  <section>
    <header><span>Latests</span></header>
    <ul class="p-articles thin">
      <li><article class="li sm article-4c8c13dd5627da332e5774b27cf40099">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/200710-ip-estatica-en-kvm/" class="thumbnail" title="IP estática en KVM"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/200710-ip-estatica-en-kvm/">IP estática en KVM</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-07-10T18:16:34JST">10 Jul 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-6e92220fbd4bf73e9add44ea35db7875">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/200706-lanzar-instancias-en-kvm-y-configurarlas-con-cloudinit/" class="thumbnail" title="Lanzar instancias en KVM y configurarlas con Cloudinit"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/200706-lanzar-instancias-en-kvm-y-configurarlas-con-cloudinit/">Lanzar instancias en KVM y configurarlas con Cloudinit</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-07-06T20:27:27JST">6 Jul 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-65945fdc2f7a451d2eba88e27bcae615">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/200627-creacion-de-vm-en-kvm-con-virsh/" class="thumbnail" title="Creación de una máquina virtual en KVM con virsh"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/200627-creacion-de-vm-en-kvm-con-virsh/">Creación de una máquina virtual en KVM con virsh</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-06-27T17:35:24JST">27 Jun 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-d4ae75e268955792710fe6fdbf38a8cd">
  <div class="header-wrapper">
    <a href="https://onthedock.github.io/post/200627-instalacion-de-kvm-en-ubuntu-20.04/" class="thumbnail" title="Instalación de KVM en Ubuntu 20.04"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://onthedock.github.io/post/200627-instalacion-de-kvm-en-ubuntu-20.04/">Instalación de KVM en Ubuntu 20.04</a></h2>
        <ul class="p-facts">
          <li><time datetime="2020-06-27T16:27:29JST">27 Jun 2020</time></li>
          <li><a href="https://onthedock.github.io/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li>
    </ul>
  </section>
  
</div>


    </main>

    

    <footer class="l-footer">
      <div class="l-container">
        <p class="copyright-notice">Handmade with &#9829; by Xavi Aznar</p>
        <aside>
          <p class="attribution">Powered by <a href="https://gohugo.io/">Hugo</a> using <a href="https://github.com/dim0627/hugo_theme_aglaus" class="h-logo">Aglaus</a> (designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>).</p>
        </aside>
      </div>
    </footer>

    <a href="#" class="p-movetop" title="ページ上部へ戻る" rel="nofollow"></a>
  </body>
</html>

